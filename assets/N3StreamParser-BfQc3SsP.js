import{c as z}from"./rdf-editor-mCQ4F84x.js";import{ae as H}from"./index-2TCwO9Hs.js";const N="http://www.w3.org/1999/02/22-rdf-syntax-ns#",R="http://www.w3.org/2001/XMLSchema#",v="http://www.w3.org/2000/10/swap/",o={xsd:{decimal:`${R}decimal`,boolean:`${R}boolean`,double:`${R}double`,integer:`${R}integer`,string:`${R}string`},rdf:{type:`${N}type`,nil:`${N}nil`,first:`${N}first`,rest:`${N}rest`,langString:`${N}langString`},owl:{sameAs:"http://www.w3.org/2002/07/owl#sameAs"},r:{forSome:`${v}reify#forSome`,forAll:`${v}reify#forAll`},log:{implies:`${v}log#implies`,isImpliedBy:`${v}log#isImpliedBy`}},{xsd:I}=o,V=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\([^])/g,C={"\\":"\\","'":"'",'"':'"',n:`
`,r:"\r",t:"	",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},Z=/[\x00-\x20<>\\"\{\}\|\^\`]/,J={_iri:!0,_unescapedIri:!0,_simpleQuotedString:!0,_langcode:!0,_blank:!0,_newline:!0,_comment:!0,_whitespace:!0,_endOfFile:!0},X=/$0^/;class K{constructor(e){if(this._iri=/^<((?:[^ <>{}\\]|\\[uU])+)>[ \t]*/,this._unescapedIri=/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>[ \t]*/,this._simpleQuotedString=/^"([^"\\\r\n]*)"(?=[^"])/,this._simpleApostropheString=/^'([^'\\\r\n]*)'(?=[^'])/,this._langcode=/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,this._prefix=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,this._prefixed=/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?:[ \t]+|(?=\.?[,;!\^\s#()\[\]\{\}"'<>]))/,this._variable=/^\?(?:(?:[A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=[.,;!\^\s#()\[\]\{\}"'<>])/,this._blank=/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?:[ \t]+|(?=\.?[,;:\s#()\[\]\{\}"'<>]))/,this._number=/^[\-+]?(?:(\d+\.\d*|\.?\d+)[eE][\-+]?|\d*(\.)?)\d+(?=\.?[,;:\s#()\[\]\{\}"'<>])/,this._boolean=/^(?:true|false)(?=[.,;\s#()\[\]\{\}"'<>])/,this._keyword=/^@[a-z]+(?=[\s#<:])/i,this._sparqlKeyword=/^(?:PREFIX|BASE|GRAPH)(?=[\s#<])/i,this._shortPredicates=/^a(?=[\s#()\[\]\{\}"'<>])/,this._newline=/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,this._comment=/#([^\n\r]*)/,this._whitespace=/^[ \t]+/,this._endOfFile=/^(?:#[^\n\r]*)?$/,e=e||{},this._isImpliedBy=e.isImpliedBy,this._lineMode=!!e.lineMode){this._n3Mode=!1;for(const s in this)!(s in J)&&this[s]instanceof RegExp&&(this[s]=X)}else this._n3Mode=e.n3!==!1;this.comments=!!e.comments,this._literalClosingPos=0}_tokenizeToEnd(e,s){let t=this._input,i=t.length;for(;;){let n,c;for(;n=this._newline.exec(t);)this.comments&&(c=this._comment.exec(n[0]))&&u("comment",c[1],"",this._line,n[0].length),t=t.substr(n[0].length,t.length),i=t.length,this._line++;if(!n&&(n=this._whitespace.exec(t))&&(t=t.substr(n[0].length,t.length)),this._endOfFile.test(t))return s&&(this.comments&&(c=this._comment.exec(t))&&u("comment",c[1],"",this._line,t.length),t=null,u("eof","","",this._line,0)),this._input=t;const _=this._line,p=t[0];let l="",d="",x="",h=null,f=0,m=!1;switch(p){case"^":if(t.length<3)break;if(t[1]==="^"){if(this._previousMarker="^^",t=t.substr(2),t[0]!=="<"){m=!0;break}}else{this._n3Mode&&(f=1,l="^");break}case"<":if(h=this._unescapedIri.exec(t))l="IRI",d=h[1];else if(h=this._iri.exec(t)){if(d=this._unescape(h[1]),d===null||Z.test(d))return a(this);l="IRI"}else t.length>1&&t[1]==="<"?(l="<<",f=2):this._n3Mode&&t.length>1&&t[1]==="="&&(f=2,this._isImpliedBy?(l="abbreviation",d="<"):(l="inverse",d=">"));break;case">":t.length>1&&t[1]===">"&&(l=">>",f=2);break;case"_":((h=this._blank.exec(t))||s&&(h=this._blank.exec(`${t} `)))&&(l="blank",x="_",d=h[1]);break;case'"':if(h=this._simpleQuotedString.exec(t))d=h[1];else if({value:d,matchLength:f}=this._parseLiteral(t),d===null)return a(this);(h!==null||f!==0)&&(l="literal",this._literalClosingPos=0);break;case"'":if(!this._lineMode){if(h=this._simpleApostropheString.exec(t))d=h[1];else if({value:d,matchLength:f}=this._parseLiteral(t),d===null)return a(this);(h!==null||f!==0)&&(l="literal",this._literalClosingPos=0)}break;case"?":this._n3Mode&&(h=this._variable.exec(t))&&(l="var",d=h[0]);break;case"@":this._previousMarker==="literal"&&(h=this._langcode.exec(t))?(l="langcode",d=h[1]):(h=this._keyword.exec(t))&&(l=h[0]);break;case".":if(t.length===1?s:t[1]<"0"||t[1]>"9"){l=".",f=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(h=this._number.exec(t)||s&&(h=this._number.exec(`${t} `)))&&(l="literal",d=h[0],x=typeof h[1]=="string"?I.double:typeof h[2]=="string"?I.decimal:I.integer);break;case"B":case"b":case"p":case"P":case"G":case"g":(h=this._sparqlKeyword.exec(t))?l=h[0].toUpperCase():m=!0;break;case"f":case"t":(h=this._boolean.exec(t))?(l="literal",d=h[0],x=I.boolean):m=!0;break;case"a":(h=this._shortPredicates.exec(t))?(l="abbreviation",d="a"):m=!0;break;case"=":this._n3Mode&&t.length>1&&(l="abbreviation",t[1]!==">"?(f=1,d="="):(f=2,d=">"));break;case"!":if(!this._n3Mode)break;case",":case";":case"[":case"]":case"(":case")":case"}":this._lineMode||(f=1,l=p);break;case"{":!this._lineMode&&t.length>=2&&(t[1]==="|"?(l="{|",f=2):(l=p,f=1));break;case"|":t.length>=2&&t[1]==="}"&&(l="|}",f=2);break;default:m=!0}if(m&&((this._previousMarker==="@prefix"||this._previousMarker==="PREFIX")&&(h=this._prefix.exec(t))?(l="prefix",d=h[1]||""):((h=this._prefixed.exec(t))||s&&(h=this._prefixed.exec(`${t} `)))&&(l="prefixed",x=h[1]||"",d=this._unescape(h[2]))),this._previousMarker==="^^")switch(l){case"prefixed":l="type";break;case"IRI":l="typeIRI";break;default:l=""}if(!l)return s||!/^'''|^"""/.test(t)&&/\n|\r/.test(t)?a(this):this._input=t;const k=f||h[0].length,Q=u(l,d,x,_,k);this.previousToken=Q,this._previousMarker=l,t=t.substr(k,t.length)}function u(n,c,_,p,l){const d=t?i-t.length:i,x=d+l,h={type:n,value:c,prefix:_,line:p,start:d,end:x};return e(null,h),h}function a(n){e(n._syntaxError(/^\S*/.exec(t)[0]))}}_unescape(e){let s=!1;const t=e.replace(V,(i,u,a,n)=>{if(typeof u=="string")return String.fromCharCode(Number.parseInt(u,16));if(typeof a=="string"){let c=Number.parseInt(a,16);return c<=65535?String.fromCharCode(Number.parseInt(a,16)):String.fromCharCode(55296+((c-=65536)>>10),56320+(c&1023))}return n in C?C[n]:(s=!0,"")});return s?null:t}_parseLiteral(e){if(e.length>=3){const s=e.match(/^(?:"""|"|'''|'|)/)[0],t=s.length;let i=Math.max(this._literalClosingPos,t);for(;(i=e.indexOf(s,i))>0;){let u=0;for(;e[i-u-1]==="\\";)u++;if(u%2===0){const a=e.substring(t,i),n=a.split(/\r\n|\r|\n/).length-1,c=i+t;if(t===1&&n!==0||t===3&&this._lineMode)break;return this._line+=n,{value:this._unescape(a),matchLength:c}}i++}this._literalClosingPos=e.length-t+1}return{value:"",matchLength:0}}_syntaxError(e){this._input=null;const s=new Error(`Unexpected "${e}" on line ${this._line}.`);return s.context={token:void 0,line:this._line,previousToken:this.previousToken},s}_readStartingBom(e){return e.startsWith("\uFEFF")?e.substr(1):e}tokenize(e,s){if(this._line=1,typeof e=="string")if(this._input=this._readStartingBom(e),typeof s=="function")queueMicrotask(()=>this._tokenizeToEnd(s,!0));else{const t=[];let i;if(this._tokenizeToEnd((u,a)=>u?i=u:t.push(a),!0),i)throw i;return t}else this._pendingBuffer=null,typeof e.setEncoding=="function"&&e.setEncoding("utf8"),e.on("data",t=>{this._input!==null&&t.length!==0&&(this._pendingBuffer&&(t=H.Buffer.concat([this._pendingBuffer,t]),this._pendingBuffer=null),t[t.length-1]&128?this._pendingBuffer=t:(typeof this._input>"u"?this._input=this._readStartingBom(typeof t=="string"?t:t.toString()):this._input+=t,this._tokenizeToEnd(s,!1)))}),e.on("end",()=>{typeof this._input=="string"&&this._tokenizeToEnd(s,!0)}),e.on("error",s)}}const{rdf:W,xsd:g}=o;let j,Y=0;const E={namedNode:D,blankNode:B,variable:M,literal:O,defaultGraph:re,quad:F,triple:F,fromTerm:P,fromQuad:G};class b{constructor(e){this.id=e}get value(){return this.id}equals(e){return e instanceof b?this.id===e.id:!!e&&this.termType===e.termType&&this.value===e.value}hashCode(){return 0}toJSON(){return{termType:this.termType,value:this.value}}}class A extends b{get termType(){return"NamedNode"}}class y extends b{get termType(){return"Literal"}get value(){return this.id.substring(1,this.id.lastIndexOf('"'))}get language(){const e=this.id;let s=e.lastIndexOf('"')+1;return s<e.length&&e[s++]==="@"?e.substr(s).toLowerCase():""}get datatype(){return new A(this.datatypeString)}get datatypeString(){const e=this.id,s=e.lastIndexOf('"')+1,t=s<e.length?e[s]:"";return t==="^"?e.substr(s+2):t!=="@"?g.string:W.langString}equals(e){return e instanceof y?this.id===e.id:!!e&&!!e.datatype&&this.termType===e.termType&&this.value===e.value&&this.language===e.language&&this.datatype.value===e.datatype.value}toJSON(){return{termType:this.termType,value:this.value,language:this.language,datatype:{termType:"NamedNode",value:this.datatypeString}}}}class ee extends b{constructor(e){super(`_:${e}`)}get termType(){return"BlankNode"}get value(){return this.id.substr(2)}}class te extends b{constructor(e){super(`?${e}`)}get termType(){return"Variable"}get value(){return this.id.substr(1)}}class se extends b{constructor(){return super(""),j||this}get termType(){return"DefaultGraph"}equals(e){return this===e||!!e&&this.termType===e.termType}}j=new se;function S(r,e,s){if(e=e||E,!r)return e.defaultGraph();switch(r[0]){case"?":return e.variable(r.substr(1));case"_":return e.blankNode(r.substr(2));case'"':if(e===E)return new y(r);if(r[r.length-1]==='"')return e.literal(r.substr(1,r.length-2));const t=r.lastIndexOf('"',r.length-1);return e.literal(r.substr(1,t-1),r[t+1]==="@"?r.substr(t+2):e.namedNode(r.substr(t+3)));case"[":r=JSON.parse(r);break;default:if(!s||!Array.isArray(r))return e.namedNode(r)}return e.quad(S(r[0],e,!0),S(r[1],e,!0),S(r[2],e,!0),r[3]&&S(r[3],e,!0))}function w(r,e){if(typeof r=="string")return r;if(r instanceof b&&r.termType!=="Quad")return r.id;if(!r)return j.id;switch(r.termType){case"NamedNode":return r.value;case"BlankNode":return`_:${r.value}`;case"Variable":return`?${r.value}`;case"DefaultGraph":return"";case"Literal":return`"${r.value}"${r.language?`@${r.language}`:r.datatype&&r.datatype.value!==g.string?`^^${r.datatype.value}`:""}`;case"Quad":const s=[w(r.subject,!0),w(r.predicate,!0),w(r.object,!0)];return r.graph&&r.graph.termType!=="DefaultGraph"&&s.push(w(r.graph,!0)),e?s:JSON.stringify(s);default:throw new Error(`Unexpected termType: ${r.termType}`)}}class $ extends b{constructor(e,s,t,i){super(""),this._subject=e,this._predicate=s,this._object=t,this._graph=i||j}get termType(){return"Quad"}get subject(){return this._subject}get predicate(){return this._predicate}get object(){return this._object}get graph(){return this._graph}toJSON(){return{termType:this.termType,subject:this._subject.toJSON(),predicate:this._predicate.toJSON(),object:this._object.toJSON(),graph:this._graph.toJSON()}}equals(e){return!!e&&this._subject.equals(e.subject)&&this._predicate.equals(e.predicate)&&this._object.equals(e.object)&&this._graph.equals(e.graph)}}function D(r){return new A(r)}function B(r){return new ee(r||`n3-${Y++}`)}function O(r,e){if(typeof e=="string")return new y(`"${r}"@${e.toLowerCase()}`);let s=e?e.value:"";return s===""&&(typeof r=="boolean"?s=g.boolean:typeof r=="number"&&(Number.isFinite(r)?s=Number.isInteger(r)?g.integer:g.double:(s=g.double,Number.isNaN(r)||(r=r>0?"INF":"-INF")))),s===""||s===g.string?new y(`"${r}"`):new y(`"${r}"^^${s}`)}function M(r){return new te(r)}function re(){return j}function F(r,e,s,t){return new $(r,e,s,t)}function P(r){if(r instanceof b)return r;switch(r.termType){case"NamedNode":return D(r.value);case"BlankNode":return B(r.value);case"Variable":return M(r.value);case"DefaultGraph":return j;case"Literal":return O(r.value,r.language||r.datatype);case"Quad":return G(r);default:throw new Error(`Unexpected termType: ${r.termType}`)}}function G(r){if(r instanceof $)return r;if(r.termType!=="Quad")throw new Error(`Unexpected termType: ${r.termType}`);return F(P(r.subject),P(r.predicate),P(r.object),P(r.graph))}let L=0;class U{constructor(e){this._contextStack=[],this._graph=null,e=e||{},this._setBase(e.baseIRI),e.factory&&q(this,e.factory);const s=typeof e.format=="string"?e.format.match(/\w*$/)[0].toLowerCase():"",t=/turtle/.test(s),i=/trig/.test(s),u=/triple/.test(s),a=/quad/.test(s),n=this._n3Mode=/n3/.test(s),c=u||a;(this._supportsNamedGraphs=!(t||n))||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(t||i||u||n),this._isImpliedBy=e.isImpliedBy,this._supportsRDFStar=s===""||/star|\*$/.test(s),c&&(this._resolveRelativeIRI=_=>null),this._blankNodePrefix=typeof e.blankNodePrefix!="string"?"":e.blankNodePrefix.replace(/^(?!_:)/,"_:"),this._lexer=e.lexer||new K({lineMode:c,n3:n,isImpliedBy:this._isImpliedBy}),this._explicitQuantifiers=!!e.explicitQuantifiers}static _resetBlankNodePrefix(){L=0}_setBase(e){if(!e)this._base="",this._basePath="";else{const s=e.indexOf("#");s>=0&&(e=e.substr(0,s)),this._base=e,this._basePath=e.indexOf("/")<0?e:e.replace(/[^\/?]*(?:\?.*)?$/,""),e=e.match(/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i),this._baseRoot=e[0],this._baseScheme=e[1]}}_saveContext(e,s,t,i,u){const a=this._n3Mode;this._contextStack.push({type:e,subject:t,predicate:i,object:u,graph:s,inverse:a?this._inversePredicate:!1,blankPrefix:a?this._prefixes._:"",quantified:a?this._quantified:null}),a&&(this._inversePredicate=!1,this._prefixes._=this._graph?`${this._graph.value}.`:".",this._quantified=Object.create(this._quantified))}_restoreContext(e,s){const t=this._contextStack.pop();if(!t||t.type!==e)return this._error(`Unexpected ${s.type}`,s);this._subject=t.subject,this._predicate=t.predicate,this._object=t.object,this._graph=t.graph,this._n3Mode&&(this._inversePredicate=t.inverse,this._prefixes._=t.blankPrefix,this._quantified=t.quantified)}_readInTopContext(e){switch(e.type){case"eof":return this._graph!==null?this._error("Unclosed graph",e):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"PREFIX":this._sparqlStyle=!0;case"@prefix":return this._readPrefix;case"BASE":this._sparqlStyle=!0;case"@base":return this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(e)}}_readEntity(e,s){let t;switch(e.type){case"IRI":case"typeIRI":const i=this._resolveIRI(e.value);if(i===null)return this._error("Invalid IRI",e);t=this._factory.namedNode(i);break;case"type":case"prefixed":const u=this._prefixes[e.prefix];if(u===void 0)return this._error(`Undefined prefix "${e.prefix}:"`,e);t=this._factory.namedNode(u+e.value);break;case"blank":t=this._factory.blankNode(this._prefixes[e.prefix]+e.value);break;case"var":t=this._factory.variable(e.value.substr(1));break;default:return this._error(`Expected entity but got ${e.type}`,e)}return!s&&this._n3Mode&&t.id in this._quantified&&(t=this._quantified[t.id]),t}_readSubject(e){switch(this._predicate=null,e.type){case"[":return this._saveContext("blank",this._graph,this._subject=this._factory.blankNode(),null,null),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this.RDF_NIL,null,null),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._graph=this._factory.blankNode(),null,null),this._readSubject):this._error("Unexpected graph",e);case"}":return this._readPunctuation(e);case"@forSome":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORSOME,this._quantifier="blankNode",this._readQuantifierList):this._error('Unexpected "@forSome"',e);case"@forAll":return this._n3Mode?(this._subject=null,this._predicate=this.N3_FORALL,this._quantifier="variable",this._readQuantifierList):this._error('Unexpected "@forAll"',e);case"literal":if(!this._n3Mode)return this._error("Unexpected literal",e);if(e.prefix.length===0)return this._literalValue=e.value,this._completeSubjectLiteral;this._subject=this._factory.literal(e.value,this._factory.namedNode(e.prefix));break;case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,null,null,null),this._graph=null,this._readSubject):this._error("Unexpected RDF-star syntax",e);default:if((this._subject=this._readEntity(e))===void 0)return;if(this._n3Mode)return this._getPathReader(this._readPredicateOrNamedGraph)}return this._readPredicateOrNamedGraph}_readPredicate(e){const s=e.type;switch(s){case"inverse":this._inversePredicate=!0;case"abbreviation":this._predicate=this.ABBREVIATIONS[e.value];break;case".":case"]":case"}":return this._predicate===null?this._error(`Unexpected ${s}`,e):(this._subject=null,s==="]"?this._readBlankNodeTail(e):this._readPunctuation(e));case";":return this._predicate!==null?this._readPredicate:this._error("Expected predicate but got ;",e);case"[":if(this._n3Mode)return this._saveContext("blank",this._graph,this._subject,this._subject=this._factory.blankNode(),null),this._readBlankNodeHead;case"blank":if(!this._n3Mode)return this._error("Disallowed blank node as predicate",e);default:if((this._predicate=this._readEntity(e))===void 0)return}return this._readObject}_readObject(e){switch(e.type){case"literal":if(e.prefix.length===0)return this._literalValue=e.value,this._readDataTypeOrLang;this._object=this._factory.literal(e.value,this._factory.namedNode(e.prefix));break;case"[":return this._saveContext("blank",this._graph,this._subject,this._predicate,this._subject=this._factory.blankNode()),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this._subject,this._predicate,this.RDF_NIL),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._factory.blankNode()),this._readSubject):this._error("Unexpected graph",e);case"<<":return this._supportsRDFStar?(this._saveContext("<<",this._graph,this._subject,this._predicate,null),this._graph=null,this._readSubject):this._error("Unexpected RDF-star syntax",e);default:if((this._object=this._readEntity(e))===void 0)return;if(this._n3Mode)return this._getPathReader(this._getContextEndReader())}return this._getContextEndReader()}_readPredicateOrNamedGraph(e){return e.type==="{"?this._readGraph(e):this._readPredicate(e)}_readGraph(e){return e.type!=="{"?this._error(`Expected graph but got ${e.type}`,e):(this._graph=this._subject,this._subject=null,this._readSubject)}_readBlankNodeHead(e){return e.type==="]"?(this._subject=null,this._readBlankNodeTail(e)):(this._predicate=null,this._readPredicate(e))}_readBlankNodeTail(e){if(e.type!=="]")return this._readBlankNodePunctuation(e);this._subject!==null&&this._emit(this._subject,this._predicate,this._object,this._graph);const s=this._predicate===null;return this._restoreContext("blank",e),this._object!==null?this._getContextEndReader():this._predicate!==null?this._readObject:s?this._readPredicateOrNamedGraph:this._readPredicateAfterBlank}_readPredicateAfterBlank(e){switch(e.type){case".":case"}":return this._subject=null,this._readPunctuation(e);default:return this._readPredicate(e)}}_readListItem(e){let s=null,t=null,i=this._readListItem;const u=this._subject,a=this._contextStack,n=a[a.length-1];switch(e.type){case"[":this._saveContext("blank",this._graph,t=this._factory.blankNode(),this.RDF_FIRST,this._subject=s=this._factory.blankNode()),i=this._readBlankNodeHead;break;case"(":this._saveContext("list",this._graph,t=this._factory.blankNode(),this.RDF_FIRST,this.RDF_NIL),this._subject=null;break;case")":if(this._restoreContext("list",e),a.length!==0&&a[a.length-1].type==="list"&&this._emit(this._subject,this._predicate,this._object,this._graph),this._predicate===null){if(i=this._readPredicate,this._subject===this.RDF_NIL)return i}else if(i=this._getContextEndReader(),this._object===this.RDF_NIL)return i;t=this.RDF_NIL;break;case"literal":e.prefix.length===0?(this._literalValue=e.value,i=this._readListItemDataTypeOrLang):(s=this._factory.literal(e.value,this._factory.namedNode(e.prefix)),i=this._getContextEndReader());break;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph=this._factory.blankNode()),this._readSubject):this._error("Unexpected graph",e);default:if((s=this._readEntity(e))===void 0)return}if(t===null&&(this._subject=t=this._factory.blankNode()),u===null?n.predicate===null?n.subject=t:n.object=t:this._emit(u,this.RDF_REST,t,this._graph),s!==null){if(this._n3Mode&&(e.type==="IRI"||e.type==="prefixed"))return this._saveContext("item",this._graph,t,this.RDF_FIRST,s),this._subject=s,this._predicate=null,this._getPathReader(this._readListItem);this._emit(t,this.RDF_FIRST,s,this._graph)}return i}_readDataTypeOrLang(e){return this._completeObjectLiteral(e,!1)}_readListItemDataTypeOrLang(e){return this._completeObjectLiteral(e,!0)}_completeLiteral(e){let s=this._factory.literal(this._literalValue);switch(e.type){case"type":case"typeIRI":const t=this._readEntity(e);if(t===void 0)return;s=this._factory.literal(this._literalValue,t),e=null;break;case"langcode":s=this._factory.literal(this._literalValue,e.value),e=null;break}return{token:e,literal:s}}_completeSubjectLiteral(e){return this._subject=this._completeLiteral(e).literal,this._readPredicateOrNamedGraph}_completeObjectLiteral(e,s){const t=this._completeLiteral(e);if(t)return this._object=t.literal,s&&this._emit(this._subject,this.RDF_FIRST,this._object,this._graph),t.token===null?this._getContextEndReader():(this._readCallback=this._getContextEndReader(),this._readCallback(t.token))}_readFormulaTail(e){return e.type!=="}"?this._readPunctuation(e):(this._subject!==null&&this._emit(this._subject,this._predicate,this._object,this._graph),this._restoreContext("formula",e),this._object===null?this._readPredicate:this._getContextEndReader())}_readPunctuation(e){let s,t=this._graph;const i=this._subject,u=this._inversePredicate;switch(e.type){case"}":if(this._graph===null)return this._error("Unexpected graph closing",e);if(this._n3Mode)return this._readFormulaTail(e);this._graph=null;case".":this._subject=null,s=this._contextStack.length?this._readSubject:this._readInTopContext,u&&(this._inversePredicate=!1);break;case";":s=this._readPredicate;break;case",":s=this._readObject;break;case"{|":if(!this._supportsRDFStar)return this._error("Unexpected RDF-star syntax",e);const a=this._predicate,n=this._object;this._subject=this._factory.quad(i,a,n,this.DEFAULTGRAPH),s=this._readPredicate;break;case"|}":if(this._subject.termType!=="Quad")return this._error("Unexpected asserted triple closing",e);this._subject=null,s=this._readPunctuation;break;default:if(this._supportsQuads&&this._graph===null&&(t=this._readEntity(e))!==void 0){s=this._readQuadPunctuation;break}return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}if(i!==null){const a=this._predicate,n=this._object;u?this._emit(n,a,i,t):this._emit(i,a,n,t)}return s}_readBlankNodePunctuation(e){let s;switch(e.type){case";":s=this._readPredicate;break;case",":s=this._readObject;break;default:return this._error(`Expected punctuation to follow "${this._object.id}"`,e)}return this._emit(this._subject,this._predicate,this._object,this._graph),s}_readQuadPunctuation(e){return e.type!=="."?this._error("Expected dot to follow quad",e):this._readInTopContext}_readPrefix(e){return e.type!=="prefix"?this._error("Expected prefix to follow @prefix",e):(this._prefix=e.value,this._readPrefixIRI)}_readPrefixIRI(e){if(e.type!=="IRI")return this._error(`Expected IRI to follow prefix "${this._prefix}:"`,e);const s=this._readEntity(e);return this._prefixes[this._prefix]=s.value,this._prefixCallback(this._prefix,s),this._readDeclarationPunctuation}_readBaseIRI(e){const s=e.type==="IRI"&&this._resolveIRI(e.value);return s?(this._setBase(s),this._readDeclarationPunctuation):this._error("Expected valid IRI to follow base declaration",e)}_readNamedGraphLabel(e){switch(e.type){case"IRI":case"blank":case"prefixed":return this._readSubject(e),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",e)}}_readNamedGraphBlankLabel(e){return e.type!=="]"?this._error("Invalid graph label",e):(this._subject=this._factory.blankNode(),this._readGraph)}_readDeclarationPunctuation(e){return this._sparqlStyle?(this._sparqlStyle=!1,this._readInTopContext(e)):e.type!=="."?this._error("Expected declaration to end with a dot",e):this._readInTopContext}_readQuantifierList(e){let s;switch(e.type){case"IRI":case"prefixed":if((s=this._readEntity(e,!0))!==void 0)break;default:return this._error(`Unexpected ${e.type}`,e)}return this._explicitQuantifiers?(this._subject===null?this._emit(this._graph||this.DEFAULTGRAPH,this._predicate,this._subject=this._factory.blankNode(),this.QUANTIFIERS_GRAPH):this._emit(this._subject,this.RDF_REST,this._subject=this._factory.blankNode(),this.QUANTIFIERS_GRAPH),this._emit(this._subject,this.RDF_FIRST,s,this.QUANTIFIERS_GRAPH)):this._quantified[s.id]=this._factory[this._quantifier](this._factory.blankNode().value),this._readQuantifierPunctuation}_readQuantifierPunctuation(e){return e.type===","?this._readQuantifierList:(this._explicitQuantifiers&&(this._emit(this._subject,this.RDF_REST,this.RDF_NIL,this.QUANTIFIERS_GRAPH),this._subject=null),this._readCallback=this._getContextEndReader(),this._readCallback(e))}_getPathReader(e){return this._afterPath=e,this._readPath}_readPath(e){switch(e.type){case"!":return this._readForwardPath;case"^":return this._readBackwardPath;default:const s=this._contextStack,t=s.length&&s[s.length-1];if(t&&t.type==="item"){const i=this._subject;this._restoreContext("item",e),this._emit(this._subject,this.RDF_FIRST,i,this._graph)}return this._afterPath(e)}}_readForwardPath(e){let s,t;const i=this._factory.blankNode();if((t=this._readEntity(e))!==void 0)return this._predicate===null?(s=this._subject,this._subject=i):(s=this._object,this._object=i),this._emit(s,t,i,this._graph),this._readPath}_readBackwardPath(e){const s=this._factory.blankNode();let t,i;if((t=this._readEntity(e))!==void 0)return this._predicate===null?(i=this._subject,this._subject=s):(i=this._object,this._object=s),this._emit(s,t,i,this._graph),this._readPath}_readRDFStarTailOrGraph(e){return e.type!==">>"?this._supportsQuads&&this._graph===null&&(this._graph=this._readEntity(e))!==void 0?this._readRDFStarTail:this._error(`Expected >> to follow "${this._object.id}"`,e):this._readRDFStarTail(e)}_readRDFStarTail(e){if(e.type!==">>")return this._error(`Expected >> but got ${e.type}`,e);const s=this._factory.quad(this._subject,this._predicate,this._object,this._graph||this.DEFAULTGRAPH);return this._restoreContext("<<",e),this._subject===null?(this._subject=s,this._readPredicate):(this._object=s,this._getContextEndReader())}_getContextEndReader(){const e=this._contextStack;if(!e.length)return this._readPunctuation;switch(e[e.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem;case"formula":return this._readFormulaTail;case"<<":return this._readRDFStarTailOrGraph}}_emit(e,s,t,i){this._callback(null,this._factory.quad(e,s,t,i||this.DEFAULTGRAPH))}_error(e,s){const t=new Error(`${e} on line ${s.line}.`);t.context={token:s,line:s.line,previousToken:this._lexer.previousToken},this._callback(t),this._callback=T}_resolveIRI(e){return/^[a-z][a-z0-9+.-]*:/i.test(e)?e:this._resolveRelativeIRI(e)}_resolveRelativeIRI(e){if(!e.length)return this._base;switch(e[0]){case"#":return this._base+e;case"?":return this._base.replace(/(?:\?.*)?$/,e);case"/":return(e[1]==="/"?this._baseScheme:this._baseRoot)+this._removeDotSegments(e);default:return/^[^/:]*:/.test(e)?null:this._removeDotSegments(this._basePath+e)}}_removeDotSegments(e){if(!/(^|\/)\.\.?($|[/#?])/.test(e))return e;const s=e.length;let t="",i=-1,u=-1,a=0,n="/";for(;i<s;){switch(n){case":":if(u<0&&e[++i]==="/"&&e[++i]==="/")for(;(u=i+1)<s&&e[u]!=="/";)i=u;break;case"?":case"#":i=s;break;case"/":if(e[i+1]===".")switch(n=e[++i+1],n){case"/":t+=e.substring(a,i-1),a=i+1;break;case void 0:case"?":case"#":return t+e.substring(a,i)+e.substr(i+1);case".":if(n=e[++i+1],n===void 0||n==="/"||n==="?"||n==="#"){if(t+=e.substring(a,i-2),(a=t.lastIndexOf("/"))>=u&&(t=t.substr(0,a)),n!=="/")return`${t}/${e.substr(i+1)}`;a=i+1}}}n=e[++i]}return t+e.substring(a)}parse(e,s,t){let i,u,a;if(s&&(s.onQuad||s.onPrefix||s.onComment)?(i=s.onQuad,u=s.onPrefix,a=s.onComment):(i=s,u=t),this._readCallback=this._readInTopContext,this._sparqlStyle=!1,this._prefixes=Object.create(null),this._prefixes._=this._blankNodePrefix?this._blankNodePrefix.substr(2):`b${L++}_`,this._prefixCallback=u||T,this._inversePredicate=!1,this._quantified=Object.create(null),!i){const c=[];let _;if(this._callback=(p,l)=>{p?_=p:l&&c.push(l)},this._lexer.tokenize(e).every(p=>this._readCallback=this._readCallback(p)),_)throw _;return c}let n=(c,_)=>{c!==null?(this._callback(c),this._callback=T):this._readCallback&&(this._readCallback=this._readCallback(_))};a&&(this._lexer.comments=!0,n=(c,_)=>{c!==null?(this._callback(c),this._callback=T):this._readCallback&&(_.type==="comment"?a(_.value):this._readCallback=this._readCallback(_))}),this._callback=i,this._lexer.tokenize(e,n)}}function T(){}function q(r,e){r._factory=e,r.DEFAULTGRAPH=e.defaultGraph(),r.RDF_FIRST=e.namedNode(o.rdf.first),r.RDF_REST=e.namedNode(o.rdf.rest),r.RDF_NIL=e.namedNode(o.rdf.nil),r.N3_FORALL=e.namedNode(o.r.forAll),r.N3_FORSOME=e.namedNode(o.r.forSome),r.ABBREVIATIONS={a:e.namedNode(o.rdf.type),"=":e.namedNode(o.owl.sameAs),">":e.namedNode(o.log.implies),"<":e.namedNode(o.log.isImpliedBy)},r.QUANTIFIERS_GRAPH=e.namedNode("urn:n3:quantifiers")}q(U.prototype,E);class ne extends z.Transform{constructor(e){super({decodeStrings:!0}),this._readableState.objectMode=!0;const s=new U(e);let t,i;const u={onQuad:(a,n)=>{a&&this.emit("error",a)||n&&this.push(n)},onPrefix:(a,n)=>{this.emit("prefix",a,n)}};e&&e.comments&&(u.onComment=a=>{this.emit("comment",a)}),s.parse({on:(a,n)=>{switch(a){case"data":t=n;break;case"end":i=n;break}}},u),this._transform=(a,n,c)=>{t(a),c()},this._flush=a=>{i(),a()}}import(e){return e.on("data",s=>{this.write(s)}),e.on("end",()=>{this.end()}),e.on("error",s=>{this.emit("error",s)}),this}}export{ee as B,E as D,y as L,ne as N,$ as Q,b as T,te as V,w as a,se as b,A as c,U as d,K as e,o as n,S as t};
