import{S as Ft}from"./index-BOvYCoiN.js";import{ab as Kt,ac as Bt}from"./index-2TCwO9Hs.js";import{r as kt}from"./readable-BmS1kvD9.js";import{r as Fe}from"./index-Bk9Nd8TQ.js";import{b as Gt,c as Mt}from"./rdf-editor-mCQ4F84x.js";import{r as Jt}from"./index-Q55tuwhF.js";import{r as $t}from"./canonicalize-53SzByLi.js";var q={},Q={},ve,ke;function qt(){if(ke)return ve;ke=1;var{Buffer:d}=Kt(),s={},c=s.LEFT_BRACE=1,g=s.RIGHT_BRACE=2,o=s.LEFT_BRACKET=3,u=s.RIGHT_BRACKET=4,r=s.COLON=5,e=s.COMMA=6,t=s.TRUE=7,n=s.FALSE=8,a=s.NULL=9,l=s.STRING=10,E=s.NUMBER=11,f=s.START=17,p=s.STOP=18,h=s.TRUE1=33,x=s.TRUE2=34,O=s.TRUE3=35,S=s.FALSE1=49,I=s.FALSE2=50,v=s.FALSE3=51,w=s.FALSE4=52,C=s.NULL1=65,m=s.NULL2=66,D=s.NULL3=67,y=s.NUMBER1=81,b=s.NUMBER3=83,T=s.STRING1=97,L=s.STRING2=98,P=s.STRING3=99,A=s.STRING4=100,j=s.STRING5=101,U=s.STRING6=102,B=s.VALUE=113,Ae=s.KEY=114,Oe=s.OBJECT=129,xe=s.ARRAY=130,Lt=92,Dt=47,Pt=8,Vt=12,Ut=10,jt=13,Ht=9,Ne=64*1024;function me(_){return d.alloc?d.alloc(_):new d(_)}function k(){this.tState=f,this.value=void 0,this.string=void 0,this.stringBuffer=me(Ne),this.stringBufferOffset=0,this.unicode=void 0,this.highSurrogate=void 0,this.key=void 0,this.mode=void 0,this.stack=[],this.state=B,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:me(2),3:me(3),4:me(4)},this.offset=-1}k.toknam=function(_){for(var R=Object.keys(s),N=0,K=R.length;N<K;N++){var G=R[N];if(s[G]===_)return G}return _&&"0x"+_.toString(16)};var F=k.prototype;return F.onError=function(_){throw _},F.charError=function(_,R){this.tState=p,this.onError(new Error("Unexpected "+JSON.stringify(String.fromCharCode(_[R]))+" at position "+R+" in state "+k.toknam(this.tState)))},F.appendStringChar=function(_){this.stringBufferOffset>=Ne&&(this.string+=this.stringBuffer.toString("utf8"),this.stringBufferOffset=0),this.stringBuffer[this.stringBufferOffset++]=_},F.appendStringBuf=function(_,R,N){var K=_.length;typeof R=="number"&&(typeof N=="number"?N<0?K=_.length-R+N:K=N-R:K=_.length-R),K<0&&(K=0),this.stringBufferOffset+K>Ne&&(this.string+=this.stringBuffer.toString("utf8",0,this.stringBufferOffset),this.stringBufferOffset=0),_.copy(this.stringBuffer,this.stringBufferOffset,R,N),this.stringBufferOffset+=K},F.write=function(_){typeof _=="string"&&(_=new d(_));for(var R,N=0,K=_.length;N<K;N++)if(this.tState===f){if(R=_[N],this.offset++,R===123)this.onToken(c,"{");else if(R===125)this.onToken(g,"}");else if(R===91)this.onToken(o,"[");else if(R===93)this.onToken(u,"]");else if(R===58)this.onToken(r,":");else if(R===44)this.onToken(e,",");else if(R===116)this.tState=h;else if(R===102)this.tState=S;else if(R===110)this.tState=C;else if(R===34)this.string="",this.stringBufferOffset=0,this.tState=T;else if(R===45)this.string="-",this.tState=y;else if(R>=48&&R<64)this.string=String.fromCharCode(R),this.tState=b;else if(!(R===32||R===9||R===10||R===13))return this.charError(_,N)}else if(this.tState===T)if(R=_[N],this.bytes_remaining>0){for(var G=0;G<this.bytes_remaining;G++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+G]=_[G];this.appendStringBuf(this.temp_buffs[this.bytes_in_sequence]),this.bytes_in_sequence=this.bytes_remaining=0,N=N+G-1}else if(this.bytes_remaining===0&&R>=128){if(R<=193||R>244)return this.onError(new Error("Invalid UTF-8 character at position "+N+" in state "+k.toknam(this.tState)));if(R>=194&&R<=223&&(this.bytes_in_sequence=2),R>=224&&R<=239&&(this.bytes_in_sequence=3),R>=240&&R<=244&&(this.bytes_in_sequence=4),this.bytes_in_sequence+N>_.length){for(var Te=0;Te<=_.length-1-N;Te++)this.temp_buffs[this.bytes_in_sequence][Te]=_[N+Te];this.bytes_remaining=N+this.bytes_in_sequence-_.length,N=_.length-1}else this.appendStringBuf(_,N,N+this.bytes_in_sequence),N=N+this.bytes_in_sequence-1}else if(R===34)this.tState=f,this.string+=this.stringBuffer.toString("utf8",0,this.stringBufferOffset),this.stringBufferOffset=0,this.onToken(l,this.string),this.offset+=d.byteLength(this.string,"utf8")+1,this.string=void 0;else if(R===92)this.tState=L;else if(R>=32)this.appendStringChar(R);else return this.charError(_,N);else if(this.tState===L)if(R=_[N],R===34)this.appendStringChar(R),this.tState=T;else if(R===92)this.appendStringChar(Lt),this.tState=T;else if(R===47)this.appendStringChar(Dt),this.tState=T;else if(R===98)this.appendStringChar(Pt),this.tState=T;else if(R===102)this.appendStringChar(Vt),this.tState=T;else if(R===110)this.appendStringChar(Ut),this.tState=T;else if(R===114)this.appendStringChar(jt),this.tState=T;else if(R===116)this.appendStringChar(Ht),this.tState=T;else if(R===117)this.unicode="",this.tState=P;else return this.charError(_,N);else if(this.tState===P||this.tState===A||this.tState===j||this.tState===U)if(R=_[N],R>=48&&R<64||R>64&&R<=70||R>96&&R<=102){if(this.unicode+=String.fromCharCode(R),this.tState++===U){var $=parseInt(this.unicode,16);this.unicode=void 0,this.highSurrogate!==void 0&&$>=56320&&$<57344?(this.appendStringBuf(new d(String.fromCharCode(this.highSurrogate,$))),this.highSurrogate=void 0):this.highSurrogate===void 0&&$>=55296&&$<56320?this.highSurrogate=$:(this.highSurrogate!==void 0&&(this.appendStringBuf(new d(String.fromCharCode(this.highSurrogate))),this.highSurrogate=void 0),this.appendStringBuf(new d(String.fromCharCode($)))),this.tState=T}}else return this.charError(_,N);else if(this.tState===y||this.tState===b)switch(R=_[N],R){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 46:case 101:case 69:case 43:case 45:this.string+=String.fromCharCode(R),this.tState=b;break;default:this.tState=f;var Be=this.numberReviver(this.string);if(Be)return Be;this.offset+=this.string.length-1,this.string=void 0,N--;break}else if(this.tState===h)if(_[N]===114)this.tState=x;else return this.charError(_,N);else if(this.tState===x)if(_[N]===117)this.tState=O;else return this.charError(_,N);else if(this.tState===O)if(_[N]===101)this.tState=f,this.onToken(t,!0),this.offset+=3;else return this.charError(_,N);else if(this.tState===S)if(_[N]===97)this.tState=I;else return this.charError(_,N);else if(this.tState===I)if(_[N]===108)this.tState=v;else return this.charError(_,N);else if(this.tState===v)if(_[N]===115)this.tState=w;else return this.charError(_,N);else if(this.tState===w)if(_[N]===101)this.tState=f,this.onToken(n,!1),this.offset+=4;else return this.charError(_,N);else if(this.tState===C)if(_[N]===117)this.tState=m;else return this.charError(_,N);else if(this.tState===m)if(_[N]===108)this.tState=D;else return this.charError(_,N);else if(this.tState===D)if(_[N]===108)this.tState=f,this.onToken(a,null),this.offset+=3;else return this.charError(_,N)},F.onToken=function(_,R){},F.parseError=function(_,R){this.tState=p,this.onError(new Error("Unexpected "+k.toknam(_)+(R?"("+JSON.stringify(R)+")":"")+" in state "+k.toknam(this.state)))},F.push=function(){this.stack.push({value:this.value,key:this.key,mode:this.mode})},F.pop=function(){var _=this.value,R=this.stack.pop();this.value=R.value,this.key=R.key,this.mode=R.mode,this.emit(_),this.mode||(this.state=B)},F.emit=function(_){this.mode&&(this.state=e),this.onValue(_)},F.onValue=function(_){},F.onToken=function(_,R){if(this.state===B)if(_===l||_===E||_===t||_===n||_===a)this.value&&(this.value[this.key]=R),this.emit(R);else if(_===c)this.push(),this.value?this.value=this.value[this.key]={}:this.value={},this.key=void 0,this.state=Ae,this.mode=Oe;else if(_===o)this.push(),this.value?this.value=this.value[this.key]=[]:this.value=[],this.key=0,this.mode=xe,this.state=B;else if(_===g)if(this.mode===Oe)this.pop();else return this.parseError(_,R);else if(_===u)if(this.mode===xe)this.pop();else return this.parseError(_,R);else return this.parseError(_,R);else if(this.state===Ae)if(_===l)this.key=R,this.state=r;else if(_===g)this.pop();else return this.parseError(_,R);else if(this.state===r)if(_===r)this.state=B;else return this.parseError(_,R);else if(this.state===e)if(_===e)this.mode===xe?(this.key++,this.state=B):this.mode===Oe&&(this.state=Ae);else if(_===u&&this.mode===xe||_===g&&this.mode===Oe)this.pop();else return this.parseError(_,R);else return this.parseError(_,R)},F.numberReviver=function(_){var R=Number(_);if(isNaN(R))return this.charError(buffer,i);_.match(/[0-9]+/)==_&&R.toString()!=_?this.onToken(l,_):this.onToken(E,R)},k.C=s,ve=k,ve}var X={},Z={},Le={},Ge;function bt(){return Ge||(Ge=1,function(){(function(d){(function(s){var c={searchParams:"URLSearchParams"in d,iterable:"Symbol"in d&&"iterator"in Symbol,blob:"FileReader"in d&&"Blob"in d&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in d,arrayBuffer:"ArrayBuffer"in d};function g(y){return y&&DataView.prototype.isPrototypeOf(y)}if(c.arrayBuffer)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(y){return y&&o.indexOf(Object.prototype.toString.call(y))>-1};function r(y){if(typeof y!="string"&&(y=String(y)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(y))throw new TypeError("Invalid character in header field name");return y.toLowerCase()}function e(y){return typeof y!="string"&&(y=String(y)),y}function t(y){var b={next:function(){var T=y.shift();return{done:T===void 0,value:T}}};return c.iterable&&(b[Symbol.iterator]=function(){return b}),b}function n(y){this.map={},y instanceof n?y.forEach(function(b,T){this.append(T,b)},this):Array.isArray(y)?y.forEach(function(b){this.append(b[0],b[1])},this):y&&Object.getOwnPropertyNames(y).forEach(function(b){this.append(b,y[b])},this)}n.prototype.append=function(y,b){y=r(y),b=e(b);var T=this.map[y];this.map[y]=T?T+", "+b:b},n.prototype.delete=function(y){delete this.map[r(y)]},n.prototype.get=function(y){return y=r(y),this.has(y)?this.map[y]:null},n.prototype.has=function(y){return this.map.hasOwnProperty(r(y))},n.prototype.set=function(y,b){this.map[r(y)]=e(b)},n.prototype.forEach=function(y,b){for(var T in this.map)this.map.hasOwnProperty(T)&&y.call(b,this.map[T],T,this)},n.prototype.keys=function(){var y=[];return this.forEach(function(b,T){y.push(T)}),t(y)},n.prototype.values=function(){var y=[];return this.forEach(function(b){y.push(b)}),t(y)},n.prototype.entries=function(){var y=[];return this.forEach(function(b,T){y.push([T,b])}),t(y)},c.iterable&&(n.prototype[Symbol.iterator]=n.prototype.entries);function a(y){if(y.bodyUsed)return Promise.reject(new TypeError("Already read"));y.bodyUsed=!0}function l(y){return new Promise(function(b,T){y.onload=function(){b(y.result)},y.onerror=function(){T(y.error)}})}function E(y){var b=new FileReader,T=l(b);return b.readAsArrayBuffer(y),T}function f(y){var b=new FileReader,T=l(b);return b.readAsText(y),T}function p(y){for(var b=new Uint8Array(y),T=new Array(b.length),L=0;L<b.length;L++)T[L]=String.fromCharCode(b[L]);return T.join("")}function h(y){if(y.slice)return y.slice(0);var b=new Uint8Array(y.byteLength);return b.set(new Uint8Array(y)),b.buffer}function x(){return this.bodyUsed=!1,this._initBody=function(y){this._bodyInit=y,y?typeof y=="string"?this._bodyText=y:c.blob&&Blob.prototype.isPrototypeOf(y)?this._bodyBlob=y:c.formData&&FormData.prototype.isPrototypeOf(y)?this._bodyFormData=y:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)?this._bodyText=y.toString():c.arrayBuffer&&c.blob&&g(y)?(this._bodyArrayBuffer=h(y.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(y)||u(y))?this._bodyArrayBuffer=h(y):this._bodyText=y=Object.prototype.toString.call(y):this._bodyText="",this.headers.get("content-type")||(typeof y=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var y=a(this);if(y)return y;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?a(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(E)}),this.text=function(){var y=a(this);if(y)return y;if(this._bodyBlob)return f(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(p(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(v)}),this.json=function(){return this.text().then(JSON.parse)},this}var O=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function S(y){var b=y.toUpperCase();return O.indexOf(b)>-1?b:y}function I(y,b){b=b||{};var T=b.body;if(y instanceof I){if(y.bodyUsed)throw new TypeError("Already read");this.url=y.url,this.credentials=y.credentials,b.headers||(this.headers=new n(y.headers)),this.method=y.method,this.mode=y.mode,this.signal=y.signal,!T&&y._bodyInit!=null&&(T=y._bodyInit,y.bodyUsed=!0)}else this.url=String(y);if(this.credentials=b.credentials||this.credentials||"same-origin",(b.headers||!this.headers)&&(this.headers=new n(b.headers)),this.method=S(b.method||this.method||"GET"),this.mode=b.mode||this.mode||null,this.signal=b.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&T)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(T)}I.prototype.clone=function(){return new I(this,{body:this._bodyInit})};function v(y){var b=new FormData;return y.trim().split("&").forEach(function(T){if(T){var L=T.split("="),P=L.shift().replace(/\+/g," "),A=L.join("=").replace(/\+/g," ");b.append(decodeURIComponent(P),decodeURIComponent(A))}}),b}function w(y){var b=new n,T=y.replace(/\r?\n[\t ]+/g," ");return T.split(/\r?\n/).forEach(function(L){var P=L.split(":"),A=P.shift().trim();if(A){var j=P.join(":").trim();b.append(A,j)}}),b}x.call(I.prototype);function C(y,b){b||(b={}),this.type="default",this.status=b.status===void 0?200:b.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in b?b.statusText:"OK",this.headers=new n(b.headers),this.url=b.url||"",this._initBody(y)}x.call(C.prototype),C.prototype.clone=function(){return new C(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new n(this.headers),url:this.url})},C.error=function(){var y=new C(null,{status:0,statusText:""});return y.type="error",y};var m=[301,302,303,307,308];C.redirect=function(y,b){if(m.indexOf(b)===-1)throw new RangeError("Invalid status code");return new C(null,{status:b,headers:{location:y}})},s.DOMException=d.DOMException;try{new s.DOMException}catch{s.DOMException=function(b,T){this.message=b,this.name=T;var L=Error(b);this.stack=L.stack},s.DOMException.prototype=Object.create(Error.prototype),s.DOMException.prototype.constructor=s.DOMException}function D(y,b){return new Promise(function(T,L){var P=new I(y,b);if(P.signal&&P.signal.aborted)return L(new s.DOMException("Aborted","AbortError"));var A=new XMLHttpRequest;function j(){A.abort()}A.onload=function(){var U={status:A.status,statusText:A.statusText,headers:w(A.getAllResponseHeaders()||"")};U.url="responseURL"in A?A.responseURL:U.headers.get("X-Request-URL");var B="response"in A?A.response:A.responseText;T(new C(B,U))},A.onerror=function(){L(new TypeError("Network request failed"))},A.ontimeout=function(){L(new TypeError("Network request failed"))},A.onabort=function(){L(new s.DOMException("Aborted","AbortError"))},A.open(P.method,P.url,!0),P.credentials==="include"?A.withCredentials=!0:P.credentials==="omit"&&(A.withCredentials=!1),"responseType"in A&&c.blob&&(A.responseType="blob"),P.headers.forEach(function(U,B){A.setRequestHeader(B,U)}),P.signal&&(P.signal.addEventListener("abort",j),A.onreadystatechange=function(){A.readyState===4&&P.signal.removeEventListener("abort",j)}),A.send(typeof P._bodyInit>"u"?null:P._bodyInit)})}return D.polyfill=!0,d.fetch||(d.fetch=D,d.Headers=n,d.Request=I,d.Response=C),s.Headers=n,s.Request=I,s.Response=C,s.fetch=D,Object.defineProperty(s,"__esModule",{value:!0}),s})({})})(typeof self<"u"?self:Le)}()),Le}var De={},Me;function Re(){return Me||(Me=1,function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.ERROR_CODES=d.ErrorCoded=void 0;class s extends Error{constructor(g,o){super(g),this.code=o}}d.ErrorCoded=s,function(c){c.COLLIDING_KEYWORDS="colliding keywords",c.CONFLICTING_INDEXES="conflicting indexes",c.CYCLIC_IRI_MAPPING="cyclic IRI mapping",c.INVALID_ID_VALUE="invalid @id value",c.INVALID_INDEX_VALUE="invalid @index value",c.INVALID_NEST_VALUE="invalid @nest value",c.INVALID_PREFIX_VALUE="invalid @prefix value",c.INVALID_PROPAGATE_VALUE="invalid @propagate value",c.INVALID_REVERSE_VALUE="invalid @reverse value",c.INVALID_IMPORT_VALUE="invalid @import value",c.INVALID_VERSION_VALUE="invalid @version value",c.INVALID_BASE_IRI="invalid base IRI",c.INVALID_CONTAINER_MAPPING="invalid container mapping",c.INVALID_CONTEXT_ENTRY="invalid context entry",c.INVALID_CONTEXT_NULLIFICATION="invalid context nullification",c.INVALID_DEFAULT_LANGUAGE="invalid default language",c.INVALID_INCLUDED_VALUE="invalid @included value",c.INVALID_IRI_MAPPING="invalid IRI mapping",c.INVALID_JSON_LITERAL="invalid JSON literal",c.INVALID_KEYWORD_ALIAS="invalid keyword alias",c.INVALID_LANGUAGE_MAP_VALUE="invalid language map value",c.INVALID_LANGUAGE_MAPPING="invalid language mapping",c.INVALID_LANGUAGE_TAGGED_STRING="invalid language-tagged string",c.INVALID_LANGUAGE_TAGGED_VALUE="invalid language-tagged value",c.INVALID_LOCAL_CONTEXT="invalid local context",c.INVALID_REMOTE_CONTEXT="invalid remote context",c.INVALID_REVERSE_PROPERTY="invalid reverse property",c.INVALID_REVERSE_PROPERTY_MAP="invalid reverse property map",c.INVALID_REVERSE_PROPERTY_VALUE="invalid reverse property value",c.INVALID_SCOPED_CONTEXT="invalid scoped context",c.INVALID_SCRIPT_ELEMENT="invalid script element",c.INVALID_SET_OR_LIST_OBJECT="invalid set or list object",c.INVALID_TERM_DEFINITION="invalid term definition",c.INVALID_TYPE_MAPPING="invalid type mapping",c.INVALID_TYPE_VALUE="invalid type value",c.INVALID_TYPED_VALUE="invalid typed value",c.INVALID_VALUE_OBJECT="invalid value object",c.INVALID_VALUE_OBJECT_VALUE="invalid value object value",c.INVALID_VOCAB_MAPPING="invalid vocab mapping",c.IRI_CONFUSED_WITH_PREFIX="IRI confused with prefix",c.KEYWORD_REDEFINITION="keyword redefinition",c.LOADING_DOCUMENT_FAILED="loading document failed",c.LOADING_REMOTE_CONTEXT_FAILED="loading remote context failed",c.MULTIPLE_CONTEXT_LINK_HEADERS="multiple context link headers",c.PROCESSING_MODE_CONFLICT="processing mode conflict",c.PROTECTED_TERM_REDEFINITION="protected term redefinition",c.CONTEXT_OVERFLOW="context overflow",c.INVALID_BASE_DIRECTION="invalid base direction",c.RECURSIVE_CONTEXT_INCLUSION="recursive context inclusion",c.INVALID_STREAMING_KEY_ORDER="invalid streaming key order",c.INVALID_EMBEDDED_NODE="invalid embedded node",c.INVALID_ANNOTATION="invalid annotation"}(d.ERROR_CODES||(d.ERROR_CODES={}))}(De)),De}var ee={},Pe,Je;function Rt(){if(Je)return Pe;Je=1;var d=/^utf-?8|ascii|utf-?16-?le|ucs-?2|base-?64|latin-?1$/i,s=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,c=/\s|\uFEFF|\xA0/,g=/\r?\n[\x20\x09]+/g,o=/[;,"]/,u=/[;,"]|\s/,r=/^[!#$%&'*+\-\.^_`|~\da-zA-Z]+$/,e={IDLE:1,URI:2,ATTR:4};function t(p){return p.replace(s,"")}function n(p){return c.test(p)}function a(p,h){for(;n(p[h]);)h++;return h}function l(p){return u.test(p)||!r.test(p)}function E(p,h){return Object.keys(p).length===Object.keys(h).length&&Object.keys(p).every(x=>x in h&&p[x]===h[x])}class f{constructor(h){this.refs=[],h&&this.parse(h)}rel(h){for(var x=[],O=h.toLowerCase(),S=0;S<this.refs.length;S++)this.refs[S].rel.toLowerCase()===O&&x.push(this.refs[S]);return x}get(h,x){h=h.toLowerCase();for(var O=[],S=0;S<this.refs.length;S++)this.refs[S][h]===x&&O.push(this.refs[S]);return O}set(h){return this.refs.push(h),this}setUnique(h){return this.refs.some(x=>E(x,h))||this.refs.push(h),this}has(h,x){h=h.toLowerCase();for(var O=0;O<this.refs.length;O++)if(this.refs[O][h]===x)return!0;return!1}parse(h,I){I=I||0,h=I?h.slice(I):h,h=t(h).replace(g,"");for(var O=e.IDLE,S=h.length,I=0,v=null;I<S;)if(O===e.IDLE){if(n(h[I])){I++;continue}else if(h[I]==="<"){v!=null&&(v.rel!=null?this.refs.push(...f.expandRelations(v)):this.refs.push(v));var w=h.indexOf(">",I);if(w===-1)throw new Error("Expected end of URI delimiter at offset "+I);v={uri:h.slice(I+1,w)},I=w,O=e.URI}else throw new Error('Unexpected character "'+h[I]+'" at offset '+I);I++}else if(O===e.URI)if(n(h[I])){I++;continue}else if(h[I]===";")O=e.ATTR,I++;else if(h[I]===",")O=e.IDLE,I++;else throw new Error('Unexpected character "'+h[I]+'" at offset '+I);else if(O===e.ATTR){if(h[I]===";"||n(h[I])){I++;continue}var w=h.indexOf("=",I);w===-1&&(w=h.indexOf(";",I)),w===-1&&(w=h.length);var C=t(h.slice(I,w)).toLowerCase(),m="";if(I=w+1,I=a(h,I),h[I]==='"')for(I++;I<S;){if(h[I]==='"'){I++;break}h[I]==="\\"&&I++,m+=h[I],I++}else{for(var w=I+1;!o.test(h[w])&&w<S;)w++;m=h.slice(I,w),I=w}switch(v[C]&&f.isSingleOccurenceAttr(C)||(C[C.length-1]==="*"?v[C]=f.parseExtendedValue(m):(m=C==="type"?m.toLowerCase():m,v[C]!=null?Array.isArray(v[C])?v[C].push(m):v[C]=[v[C],m]:v[C]=m)),h[I]){case",":O=e.IDLE;break;case";":O=e.ATTR;break}I++}else throw new Error('Unknown parser state "'+O+'"');return v!=null&&(v.rel!=null?this.refs.push(...f.expandRelations(v)):this.refs.push(v)),v=null,this}toString(){for(var h=[],x="",O=null,S=0;S<this.refs.length;S++)O=this.refs[S],x=Object.keys(this.refs[S]).reduce(function(I,v){return v==="uri"?I:I+"; "+f.formatAttribute(v,O[v])},"<"+O.uri+">"),h.push(x);return h.join(", ")}}return f.isCompatibleEncoding=function(p){return d.test(p)},f.parse=function(p,h){return new f().parse(p,h)},f.isSingleOccurenceAttr=function(p){return p==="rel"||p==="type"||p==="media"||p==="title"||p==="title*"},f.isTokenAttr=function(p){return p==="rel"||p==="type"||p==="anchor"},f.escapeQuotes=function(p){return p.replace(/"/g,'\\"')},f.expandRelations=function(p){var h=p.rel.split(" ");return h.map(function(x){var O=Object.assign({},p);return O.rel=x,O})},f.parseExtendedValue=function(p){var h=/([^']+)?(?:'([^']*)')?(.+)/.exec(p);return{language:h[2].toLowerCase(),encoding:f.isCompatibleEncoding(h[1])?null:h[1].toLowerCase(),value:f.isCompatibleEncoding(h[1])?decodeURIComponent(h[3]):h[3]}},f.formatExtendedAttribute=function(p,h){var x=(h.encoding||"utf-8").toUpperCase(),O=h.language||"en",S="";return Buffer.isBuffer(h.value)&&f.isCompatibleEncoding(x)?S=h.value.toString(x):Buffer.isBuffer(h.value)?S=h.value.toString("hex").replace(/[0-9a-f]{2}/gi,"%$1"):S=encodeURIComponent(h.value),p+"="+x+"'"+O+"'"+S},f.formatAttribute=function(p,h){return Array.isArray(h)?h.map(x=>f.formatAttribute(p,x)).join("; "):p[p.length-1]==="*"||typeof h!="string"?f.formatExtendedAttribute(p,h):(f.isTokenAttr(p)?h=l(h)?'"'+f.escapeQuotes(h)+'"':f.escapeQuotes(h):l(h)&&(h=encodeURIComponent(h),h=h.replace(/%20/g," ").replace(/%2C/g,",").replace(/%3B/g,";"),h='"'+h+'"'),p+"="+h)},Pe=f,Pe}var $e;function Ot(){if($e)return ee;$e=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.FetchDocumentLoader=void 0,bt();const d=Re(),s=Rt(),c=Fe();let g=class{constructor(u){this.fetcher=u}async load(u){const r=await(this.fetcher||fetch)(u,{headers:new Headers({accept:"application/ld+json"})});if(r.ok&&r.headers){let e=r.headers.get("Content-Type");if(e){const t=e.indexOf(";");t>0&&(e=e.substr(0,t))}if(e==="application/ld+json")return await r.json();if(r.headers.has("Link")){let t;if(r.headers.forEach((n,a)=>{if(a==="link"){const l=(0,s.parse)(n);for(const E of l.get("type","application/ld+json"))if(E.rel==="alternate"){if(t)throw new Error("Multiple JSON-LD alternate links were found on "+u);t=(0,c.resolve)(E.uri,u)}}}),t)return this.load(t)}throw new d.ErrorCoded(`Unsupported JSON-LD media type ${e}`,d.ERROR_CODES.LOADING_DOCUMENT_FAILED)}else throw new Error(r.statusText||`Status code: ${r.status}`)}};return ee.FetchDocumentLoader=g,ee}var Ve={},te={},qe;function Ke(){if(qe)return te;qe=1,Object.defineProperty(te,"__esModule",{value:!0}),te.Util=void 0;class d{static isCompactIri(c){return c.indexOf(":")>0&&!(c&&c[0]==="#")}static getPrefix(c,g){if(c&&c[0]==="#")return null;const o=c.indexOf(":");if(o>=0){if(c.length>o+1&&c.charAt(o+1)==="/"&&c.charAt(o+2)==="/")return null;const u=c.substr(0,o);if(u==="_")return null;if(g[u])return u}return null}static getContextValueId(c){if(c===null||typeof c=="string")return c;const g=c["@id"];return g||null}static isSimpleTermDefinitionPrefix(c,g){return!d.isPotentialKeyword(c)&&(g.allowPrefixNonGenDelims||typeof c=="string"&&(c[0]==="_"||d.isPrefixIriEndingWithGenDelim(c)))}static isPotentialKeyword(c){return typeof c=="string"&&d.KEYWORD_REGEX.test(c)}static isPrefixIriEndingWithGenDelim(c){return d.ENDS_WITH_GEN_DELIM.test(c)}static isPrefixValue(c){return c&&(typeof c=="string"||c&&typeof c=="object")}static isValidIri(c){return!!(c&&d.IRI_REGEX.test(c))}static isValidIriWeak(c){return!!c&&c[0]!==":"&&d.IRI_REGEX_WEAK.test(c)}static isValidKeyword(c){return d.VALID_KEYWORDS[c]}static isTermProtected(c,g){const o=c[g];return typeof o!="string"&&o&&o["@protected"]}static hasProtectedTerms(c){for(const g of Object.keys(c))if(d.isTermProtected(c,g))return!0;return!1}static isReservedInternalKeyword(c){return c.startsWith("@__")}static deepEqual(c,g){const o=Object.keys(c),u=Object.keys(g);return o.length!==u.length?!1:o.every(r=>{const e=c[r],t=g[r];return e===t||e!==null&&t!==null&&typeof e=="object"&&typeof t=="object"&&this.deepEqual(e,t)})}}return d.IRI_REGEX=/^([A-Za-z][A-Za-z0-9+-.]*|_):[^ "<>{}|\\\[\]`#]*(#[^#]*)?$/,d.IRI_REGEX_WEAK=/(?::[^:])|\//,d.KEYWORD_REGEX=/^@[a-z]+$/i,d.ENDS_WITH_GEN_DELIM=/[:/?#\[\]@]$/,d.REGEX_LANGUAGE_TAG=/^[a-zA-Z]+(-[a-zA-Z0-9]+)*$/,d.REGEX_DIRECTION_TAG=/^(ltr)|(rtl)$/,d.VALID_KEYWORDS={"@annotation":!0,"@base":!0,"@container":!0,"@context":!0,"@direction":!0,"@graph":!0,"@id":!0,"@import":!0,"@included":!0,"@index":!0,"@json":!0,"@language":!0,"@list":!0,"@nest":!0,"@none":!0,"@prefix":!0,"@propagate":!0,"@protected":!0,"@reverse":!0,"@set":!0,"@type":!0,"@value":!0,"@version":!0,"@vocab":!0},d.EXPAND_KEYS_BLACKLIST=["@base","@vocab","@language","@version","@direction"],d.ALIAS_DOMAIN_BLACKLIST=["@container","@graph","@id","@index","@list","@nest","@none","@prefix","@reverse","@set","@type","@value","@version"],d.ALIAS_RANGE_BLACKLIST=["@context","@preserve"],d.CONTAINERS=["@list","@set","@index","@language","@graph","@id","@type"],d.CONTAINERS_1_0=["@list","@set","@index"],te.Util=d,te}var Xe;function xt(){return Xe||(Xe=1,function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.defaultExpandOptions=d.JsonLdContextNormalized=void 0;const s=Fe(),c=Re(),g=Ke();class o{constructor(r){this.contextRaw=r}getContextRaw(){return this.contextRaw}expandTerm(r,e,t=d.defaultExpandOptions){const n=this.contextRaw[r];if(n===null||n&&n["@id"]===null)return null;let a=!0;if(n&&e){const x=g.Util.getContextValueId(n);if(x&&x!==r)if(typeof x!="string"||!g.Util.isValidIri(x)&&!g.Util.isValidKeyword(x))g.Util.isPotentialKeyword(x)||(a=!1);else return x}const l=g.Util.getPrefix(r,this.contextRaw),E=this.contextRaw["@vocab"],f=(!!E||E==="")&&E.indexOf(":")<0,p=this.contextRaw["@base"],h=g.Util.isPotentialKeyword(r);if(l){const x=this.contextRaw[l],O=g.Util.getContextValueId(x);if(O){if(typeof x=="string"||!t.allowPrefixForcing){if(!g.Util.isSimpleTermDefinitionPrefix(O,t))return r}else if(O[0]!=="_"&&!h&&!x["@prefix"]&&!(r in this.contextRaw))return r;return O+r.substr(l.length+1)}}else if(e&&(E||E===""||t.allowVocabRelativeToBase&&p&&f)&&!h&&!g.Util.isCompactIri(r))if(f){if(t.allowVocabRelativeToBase)return(E||p?(0,s.resolve)(E,p):"")+r;throw new c.ErrorCoded(`Relative vocab expansion for term '${r}' with vocab '${E}' is not allowed.`,c.ERROR_CODES.INVALID_VOCAB_MAPPING)}else return E+r;else if(!e&&p&&!h&&!g.Util.isCompactIri(r))return(0,s.resolve)(r,p);if(a)return r;throw new c.ErrorCoded(`Invalid IRI mapping found for context entry '${r}': '${JSON.stringify(n)}'`,c.ERROR_CODES.INVALID_IRI_MAPPING)}compactIri(r,e){if(e&&this.contextRaw["@vocab"]&&r.startsWith(this.contextRaw["@vocab"]))return r.substr(this.contextRaw["@vocab"].length);if(!e&&this.contextRaw["@base"]&&r.startsWith(this.contextRaw["@base"]))return r.substr(this.contextRaw["@base"].length);const t={prefix:"",suffix:r};for(const n in this.contextRaw){const a=this.contextRaw[n];if(a&&!g.Util.isPotentialKeyword(n)){const l=g.Util.getContextValueId(a);if(r.startsWith(l)){const E=r.substr(l.length);if(E)E.length<t.suffix.length&&(t.prefix=n,t.suffix=E);else if(e)return n}}}return t.prefix?t.prefix+":"+t.suffix:r}}d.JsonLdContextNormalized=o,d.defaultExpandOptions={allowPrefixForcing:!0,allowPrefixNonGenDelims:!1,allowVocabRelativeToBase:!0}}(Ve)),Ve}var We;function Xt(){if(We)return Z;We=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.ContextParser=void 0,bt();const d=Fe(),s=Re(),c=Ot(),g=xt(),o=Ke();let u=class W{constructor(e){e=e||{},this.documentLoader=e.documentLoader||new c.FetchDocumentLoader,this.documentCache={},this.validateContext=!e.skipValidation,this.expandContentTypeToBase=!!e.expandContentTypeToBase,this.remoteContextsDepthLimit=e.remoteContextsDepthLimit||32,this.redirectSchemaOrgHttps="redirectSchemaOrgHttps"in e?!!e.redirectSchemaOrgHttps:!0}static validateLanguage(e,t,n){if(typeof e!="string")throw new s.ErrorCoded(`The value of an '@language' must be a string, got '${JSON.stringify(e)}'`,n);if(!o.Util.REGEX_LANGUAGE_TAG.test(e)){if(t)throw new s.ErrorCoded(`The value of an '@language' must be a valid language tag, got '${JSON.stringify(e)}'`,n);return!1}return!0}static validateDirection(e,t){if(typeof e!="string")throw new s.ErrorCoded(`The value of an '@direction' must be a string, got '${JSON.stringify(e)}'`,s.ERROR_CODES.INVALID_BASE_DIRECTION);if(!o.Util.REGEX_DIRECTION_TAG.test(e)){if(t)throw new s.ErrorCoded(`The value of an '@direction' must be 'ltr' or 'rtl', got '${JSON.stringify(e)}'`,s.ERROR_CODES.INVALID_BASE_DIRECTION);return!1}return!0}idifyReverseTerms(e){for(const t of Object.keys(e)){let n=e[t];if(n&&typeof n=="object"&&n["@reverse"]&&!n["@id"]){if(typeof n["@reverse"]!="string"||o.Util.isValidKeyword(n["@reverse"]))throw new s.ErrorCoded(`Invalid @reverse value, must be absolute IRI or blank node: '${n["@reverse"]}'`,s.ERROR_CODES.INVALID_IRI_MAPPING);n=e[t]=Object.assign(Object.assign({},n),{"@id":n["@reverse"]}),n["@id"]=n["@reverse"],o.Util.isPotentialKeyword(n["@reverse"])?delete n["@reverse"]:n["@reverse"]=!0}}return e}expandPrefixedTerms(e,t,n){const a=e.getContextRaw();for(const l of n||Object.keys(a))if(o.Util.EXPAND_KEYS_BLACKLIST.indexOf(l)<0&&!o.Util.isReservedInternalKeyword(l)){const E=a[l];if(o.Util.isPotentialKeyword(l)&&o.Util.ALIAS_DOMAIN_BLACKLIST.indexOf(l)>=0&&(l!=="@type"||typeof a[l]=="object"&&!(a[l]["@protected"]||a[l]["@container"]==="@set")))throw new s.ErrorCoded(`Keywords can not be aliased to something else.
Tried mapping ${l} to ${JSON.stringify(E)}`,s.ERROR_CODES.KEYWORD_REDEFINITION);if(o.Util.ALIAS_RANGE_BLACKLIST.indexOf(o.Util.getContextValueId(E))>=0)throw new s.ErrorCoded(`Aliasing to certain keywords is not allowed.
Tried mapping ${l} to ${JSON.stringify(E)}`,s.ERROR_CODES.INVALID_KEYWORD_ALIAS);if(E&&o.Util.isPotentialKeyword(o.Util.getContextValueId(E))&&E["@prefix"]===!0)throw new s.ErrorCoded(`Tried to use keyword aliases as prefix: '${l}': '${JSON.stringify(E)}'`,s.ERROR_CODES.INVALID_TERM_DEFINITION);for(;o.Util.isPrefixValue(a[l]);){const f=a[l];let p=!1;if(typeof f=="string")a[l]=e.expandTerm(f,!0),p=p||f!==a[l];else{const h=f["@id"],x=f["@type"],O=!("@prefix"in f)||o.Util.isValidIri(l);if("@id"in f)h!=null&&typeof h=="string"&&(a[l]=Object.assign(Object.assign({},a[l]),{"@id":e.expandTerm(h,!0)}),p=p||h!==a[l]["@id"]);else if(!o.Util.isPotentialKeyword(l)&&O){const S=e.expandTerm(l,!0);S!==l&&(a[l]=Object.assign(Object.assign({},a[l]),{"@id":S}),p=!0)}if(x&&typeof x=="string"&&x!=="@vocab"&&(!f["@container"]||!f["@container"]["@type"])&&O){let S=e.expandTerm(x,!0);t&&x===S&&(S=e.expandTerm(x,!1)),S!==x&&(p=!0,a[l]=Object.assign(Object.assign({},a[l]),{"@type":S}))}}if(!p)break}}}normalize(e,{processingMode:t,normalizeLanguageTags:n}){if(n||t===1)for(const a of Object.keys(e))if(a==="@language"&&typeof e[a]=="string")e[a]=e[a].toLowerCase();else{const l=e[a];if(l&&typeof l=="object"&&typeof l["@language"]=="string"){const E=l["@language"].toLowerCase();E!==l["@language"]&&(e[a]=Object.assign(Object.assign({},l),{"@language":E}))}}}containersToHash(e){for(const t of Object.keys(e)){const n=e[t];if(n&&typeof n=="object"){if(typeof n["@container"]=="string")e[t]=Object.assign(Object.assign({},n),{"@container":{[n["@container"]]:!0}});else if(Array.isArray(n["@container"])){const a={};for(const l of n["@container"])a[l]=!0;e[t]=Object.assign(Object.assign({},n),{"@container":a})}}}}applyScopedProtected(e,{processingMode:t},n){if(t&&t>=1.1&&e["@protected"]){for(const a of Object.keys(e))if(!o.Util.isReservedInternalKeyword(a)&&!o.Util.isPotentialKeyword(a)&&!o.Util.isTermProtected(e,a)){const l=e[a];l&&typeof l=="object"?"@protected"in e[a]||(e[a]=Object.assign(Object.assign({},e[a]),{"@protected":!0})):(e[a]={"@id":l,"@protected":!0},o.Util.isSimpleTermDefinitionPrefix(l,n)&&(e[a]=Object.assign(Object.assign({},e[a]),{"@prefix":!0})))}delete e["@protected"]}}validateKeywordRedefinitions(e,t,n,a){for(const l of a??Object.keys(t))if(o.Util.isTermProtected(e,l)&&(typeof t[l]=="string"?t[l]={"@id":t[l],"@protected":!0}:t[l]=Object.assign(Object.assign({},t[l]),{"@protected":!0}),!o.Util.deepEqual(e[l],t[l])))throw new s.ErrorCoded(`Attempted to override the protected keyword ${l} from ${JSON.stringify(o.Util.getContextValueId(e[l]))} to ${JSON.stringify(o.Util.getContextValueId(t[l]))}`,s.ERROR_CODES.PROTECTED_TERM_REDEFINITION)}validate(e,{processingMode:t}){for(const n of Object.keys(e)){if(o.Util.isReservedInternalKeyword(n))continue;if(n==="")throw new s.ErrorCoded(`The empty term is not allowed, got: '${n}': '${JSON.stringify(e[n])}'`,s.ERROR_CODES.INVALID_TERM_DEFINITION);const a=e[n],l=typeof a;if(o.Util.isPotentialKeyword(n)){switch(n.substr(1)){case"vocab":if(a!==null&&l!=="string")throw new s.ErrorCoded(`Found an invalid @vocab IRI: ${a}`,s.ERROR_CODES.INVALID_VOCAB_MAPPING);break;case"base":if(a!==null&&l!=="string")throw new s.ErrorCoded(`Found an invalid @base IRI: ${e[n]}`,s.ERROR_CODES.INVALID_BASE_IRI);break;case"language":a!==null&&W.validateLanguage(a,!0,s.ERROR_CODES.INVALID_DEFAULT_LANGUAGE);break;case"version":if(a!==null&&l!=="number")throw new s.ErrorCoded(`Found an invalid @version number: ${a}`,s.ERROR_CODES.INVALID_VERSION_VALUE);break;case"direction":a!==null&&W.validateDirection(a,!0);break;case"propagate":if(t===1)throw new s.ErrorCoded(`Found an illegal @propagate keyword: ${a}`,s.ERROR_CODES.INVALID_CONTEXT_ENTRY);if(a!==null&&l!=="boolean")throw new s.ErrorCoded(`Found an invalid @propagate value: ${a}`,s.ERROR_CODES.INVALID_PROPAGATE_VALUE);break}if(o.Util.isValidKeyword(n)&&o.Util.isValidKeyword(o.Util.getContextValueId(a)))throw new s.ErrorCoded(`Illegal keyword alias in term value, found: '${n}': '${o.Util.getContextValueId(a)}'`,s.ERROR_CODES.KEYWORD_REDEFINITION);continue}if(a!==null)switch(l){case"string":if(o.Util.getPrefix(a,e)===n)throw new s.ErrorCoded(`Detected cyclical IRI mapping in context entry: '${n}': '${JSON.stringify(a)}'`,s.ERROR_CODES.CYCLIC_IRI_MAPPING);if(o.Util.isValidIriWeak(n)){if(a==="@type")throw new s.ErrorCoded(`IRIs can not be mapped to @type, found: '${n}': '${a}'`,s.ERROR_CODES.INVALID_IRI_MAPPING);if(o.Util.isValidIri(a)&&a!==new g.JsonLdContextNormalized(e).expandTerm(n))throw new s.ErrorCoded(`IRIs can not be mapped to other IRIs, found: '${n}': '${a}'`,s.ERROR_CODES.INVALID_IRI_MAPPING)}break;case"object":if(!o.Util.isCompactIri(n)&&!("@id"in a)&&(a["@type"]==="@id"?!e["@base"]:!e["@vocab"]))throw new s.ErrorCoded(`Missing @id in context entry: '${n}': '${JSON.stringify(a)}'`,s.ERROR_CODES.INVALID_IRI_MAPPING);for(const E of Object.keys(a)){const f=a[E];if(f)switch(E){case"@id":if(o.Util.isValidKeyword(f)&&f!=="@type"&&f!=="@id"&&f!=="@graph"&&f!=="@nest")throw new s.ErrorCoded(`Illegal keyword alias in term value, found: '${n}': '${JSON.stringify(a)}'`,s.ERROR_CODES.INVALID_IRI_MAPPING);if(o.Util.isValidIriWeak(n)){if(f==="@type")throw new s.ErrorCoded(`IRIs can not be mapped to @type, found: '${n}': '${JSON.stringify(a)}'`,s.ERROR_CODES.INVALID_IRI_MAPPING);if(o.Util.isValidIri(f)&&f!==new g.JsonLdContextNormalized(e).expandTerm(n))throw new s.ErrorCoded(`IRIs can not be mapped to other IRIs, found: '${n}': '${JSON.stringify(a)}'`,s.ERROR_CODES.INVALID_IRI_MAPPING)}if(typeof f!="string")throw new s.ErrorCoded(`Detected non-string @id in context entry: '${n}': '${JSON.stringify(a)}'`,s.ERROR_CODES.INVALID_IRI_MAPPING);if(o.Util.getPrefix(f,e)===n)throw new s.ErrorCoded(`Detected cyclical IRI mapping in context entry: '${n}': '${JSON.stringify(a)}'`,s.ERROR_CODES.CYCLIC_IRI_MAPPING);break;case"@type":if(a["@container"]==="@type"&&f!=="@id"&&f!=="@vocab")throw new s.ErrorCoded(`@container: @type only allows @type: @id or @vocab, but got: '${n}': '${f}'`,s.ERROR_CODES.INVALID_TYPE_MAPPING);if(typeof f!="string")throw new s.ErrorCoded(`The value of an '@type' must be a string, got '${JSON.stringify(l)}'`,s.ERROR_CODES.INVALID_TYPE_MAPPING);if(f!=="@id"&&f!=="@vocab"&&(t===1||f!=="@json")&&(t===1||f!=="@none")&&(f[0]==="_"||!o.Util.isValidIri(f)))throw new s.ErrorCoded(`A context @type must be an absolute IRI, found: '${n}': '${f}'`,s.ERROR_CODES.INVALID_TYPE_MAPPING);break;case"@reverse":if(typeof f=="string"&&a["@id"]&&a["@id"]!==f)throw new s.ErrorCoded(`Found non-matching @id and @reverse term values in '${n}':'${f}' and '${a["@id"]}'`,s.ERROR_CODES.INVALID_REVERSE_PROPERTY);if("@nest"in a)throw new s.ErrorCoded(`@nest is not allowed in the reverse property '${n}'`,s.ERROR_CODES.INVALID_REVERSE_PROPERTY);break;case"@container":if(t===1&&(Object.keys(f).length>1||o.Util.CONTAINERS_1_0.indexOf(Object.keys(f)[0])<0))throw new s.ErrorCoded(`Invalid term @container for '${n}' ('${Object.keys(f)}') in 1.0, must be only one of ${o.Util.CONTAINERS_1_0.join(", ")}`,s.ERROR_CODES.INVALID_CONTAINER_MAPPING);for(const p of Object.keys(f)){if(p==="@list"&&a["@reverse"])throw new s.ErrorCoded(`Term value can not be @container: @list and @reverse at the same time on '${n}'`,s.ERROR_CODES.INVALID_REVERSE_PROPERTY);if(o.Util.CONTAINERS.indexOf(p)<0)throw new s.ErrorCoded(`Invalid term @container for '${n}' ('${p}'), must be one of ${o.Util.CONTAINERS.join(", ")}`,s.ERROR_CODES.INVALID_CONTAINER_MAPPING)}break;case"@language":W.validateLanguage(f,!0,s.ERROR_CODES.INVALID_LANGUAGE_MAPPING);break;case"@direction":W.validateDirection(f,!0);break;case"@prefix":if(f!==null&&typeof f!="boolean")throw new s.ErrorCoded(`Found an invalid term @prefix boolean in: '${n}': '${JSON.stringify(a)}'`,s.ERROR_CODES.INVALID_PREFIX_VALUE);if(!("@id"in a)&&!o.Util.isValidIri(n))throw new s.ErrorCoded(`Invalid @prefix definition for '${n}' ('${JSON.stringify(a)}'`,s.ERROR_CODES.INVALID_TERM_DEFINITION);break;case"@index":if(t===1||!a["@container"]||!a["@container"]["@index"])throw new s.ErrorCoded(`Attempt to add illegal key to value object: '${n}': '${JSON.stringify(a)}'`,s.ERROR_CODES.INVALID_TERM_DEFINITION);break;case"@nest":if(o.Util.isPotentialKeyword(f)&&f!=="@nest")throw new s.ErrorCoded(`Found an invalid term @nest value in: '${n}': '${JSON.stringify(a)}'`,s.ERROR_CODES.INVALID_NEST_VALUE)}}break;default:throw new s.ErrorCoded(`Found an invalid term value: '${n}': '${a}'`,s.ERROR_CODES.INVALID_TERM_DEFINITION)}}}applyBaseEntry(e,t,n){return typeof e=="string"||(n&&!("@base"in e)&&t.parentContext&&typeof t.parentContext=="object"&&"@base"in t.parentContext&&(e["@base"]=t.parentContext["@base"],t.parentContext["@__baseDocument"]&&(e["@__baseDocument"]=!0)),t.baseIRI&&!t.external&&("@base"in e?e["@base"]!==null&&typeof e["@base"]=="string"&&!o.Util.isValidIri(e["@base"])&&(e["@base"]=(0,d.resolve)(e["@base"],t.parentContext&&t.parentContext["@base"]||t.baseIRI)):(e["@base"]=t.baseIRI,e["@__baseDocument"]=!0))),e}normalizeContextIri(e,t){if(!o.Util.isValidIri(e))try{e=(0,d.resolve)(e,t)}catch{throw new Error(`Invalid context IRI: ${e}`)}return this.redirectSchemaOrgHttps&&e.startsWith("http://schema.org")&&(e="https://schema.org/"),e}async parseInnerContexts(e,t,n){for(const a of n??Object.keys(e)){const l=e[a];if(l&&typeof l=="object"&&"@context"in l&&l["@context"]!==null&&!t.ignoreScopedContexts){if(this.validateContext)try{const E=Object.assign(Object.assign({},e),{[a]:Object.assign({},e[a])});delete E[a]["@context"],await this.parse(l["@context"],Object.assign(Object.assign({},t),{external:!1,parentContext:E,ignoreProtection:!0,ignoreRemoteScopedContexts:!0,ignoreScopedContexts:!0}))}catch(E){throw new s.ErrorCoded(E.message,s.ERROR_CODES.INVALID_SCOPED_CONTEXT)}e[a]=Object.assign(Object.assign({},l),{"@context":(await this.parse(l["@context"],Object.assign(Object.assign({},t),{external:!1,minimalProcessing:!0,ignoreRemoteScopedContexts:!0,parentContext:e}))).getContextRaw()})}}return e}async parse(e,t={},n={}){const{baseIRI:a,parentContext:l,external:E,processingMode:f=W.DEFAULT_PROCESSING_MODE,normalizeLanguageTags:p,ignoreProtection:h,minimalProcessing:x}=t,O=t.remoteContexts||{};if(Object.keys(O).length>=this.remoteContextsDepthLimit)throw new s.ErrorCoded("Detected an overflow in remote context inclusions: "+Object.keys(O),s.ERROR_CODES.CONTEXT_OVERFLOW);if(e==null){if(!h&&l&&o.Util.hasProtectedTerms(l))throw new s.ErrorCoded("Illegal context nullification when terms are protected",s.ERROR_CODES.INVALID_CONTEXT_NULLIFICATION);return new g.JsonLdContextNormalized(this.applyBaseEntry({},t,!1))}else if(typeof e=="string"){const S=this.normalizeContextIri(e,a),I=this.getOverriddenLoad(S,t);if(I)return new g.JsonLdContextNormalized(I);const v=await this.parse(await this.load(S),Object.assign(Object.assign({},t),{baseIRI:S,external:!0,remoteContexts:Object.assign(Object.assign({},O),{[S]:!0})}));return this.applyBaseEntry(v.getContextRaw(),t,!0),v}else if(Array.isArray(e)){const S=[],I=await Promise.all(e.map((w,C)=>{if(typeof w=="string"){const m=this.normalizeContextIri(w,a);S[C]=m;const D=this.getOverriddenLoad(m,t);return D||this.load(m)}else return w}));if(x)return new g.JsonLdContextNormalized(I);const v=await I.reduce((w,C,m)=>w.then(D=>this.parse(C,Object.assign(Object.assign({},t),{baseIRI:S[m]||t.baseIRI,external:!!S[m]||t.external,parentContext:D.getContextRaw(),remoteContexts:S[m]?Object.assign(Object.assign({},O),{[S[m]]:!0}):O}),{skipValidation:m<I.length-1})),Promise.resolve(new g.JsonLdContextNormalized(l||{})));return this.applyBaseEntry(v.getContextRaw(),t,!0),v}else if(typeof e=="object"){if("@context"in e)return await this.parse(e["@context"],t);if(e=Object.assign({},e),E&&delete e["@base"],this.applyBaseEntry(e,t,!0),this.containersToHash(e),x)return new g.JsonLdContextNormalized(e);let S={};if("@import"in e)if(f>=1.1){if(typeof e["@import"]!="string")throw new s.ErrorCoded("An @import value must be a string, but got "+typeof e["@import"],s.ERROR_CODES.INVALID_IMPORT_VALUE);S=await this.loadImportContext(this.normalizeContextIri(e["@import"],a)),delete e["@import"]}else throw new s.ErrorCoded("Context importing is not supported in JSON-LD 1.0",s.ERROR_CODES.INVALID_CONTEXT_ENTRY);this.applyScopedProtected(S,{processingMode:f},g.defaultExpandOptions);const I=Object.assign(S,e);this.idifyReverseTerms(I),this.normalize(I,{processingMode:f,normalizeLanguageTags:p}),this.applyScopedProtected(I,{processingMode:f},g.defaultExpandOptions);const v=Object.keys(I),w=[];if(typeof l=="object")for(const m in l)m in I?w.push(m):I[m]=l[m];await this.parseInnerContexts(I,t,v);const C=new g.JsonLdContextNormalized(I);return(I&&I["@version"]||W.DEFAULT_PROCESSING_MODE)>=1.1&&(e["@vocab"]&&typeof e["@vocab"]=="string"||e["@vocab"]==="")&&(l&&"@vocab"in l&&e["@vocab"].indexOf(":")<0?I["@vocab"]=l["@vocab"]+e["@vocab"]:(o.Util.isCompactIri(e["@vocab"])||e["@vocab"]in I)&&(I["@vocab"]=C.expandTerm(e["@vocab"],!0))),this.expandPrefixedTerms(C,this.expandContentTypeToBase,v),!h&&l&&f>=1.1&&this.validateKeywordRedefinitions(l,I,g.defaultExpandOptions,w),this.validateContext&&!n.skipValidation&&this.validate(I,{processingMode:f}),C}else throw new s.ErrorCoded(`Tried parsing a context that is not a string, array or object, but got ${e}`,s.ERROR_CODES.INVALID_LOCAL_CONTEXT)}async load(e){const t=this.documentCache[e];if(t)return t;let n;try{n=await this.documentLoader.load(e)}catch(a){throw new s.ErrorCoded(`Failed to load remote context ${e}: ${a.message}`,s.ERROR_CODES.LOADING_REMOTE_CONTEXT_FAILED)}if(!("@context"in n))throw new s.ErrorCoded(`Missing @context in remote context at ${e}`,s.ERROR_CODES.INVALID_REMOTE_CONTEXT);return this.documentCache[e]=n["@context"]}getOverriddenLoad(e,t){if(e in(t.remoteContexts||{})){if(t.ignoreRemoteScopedContexts)return e;throw new s.ErrorCoded("Detected a cyclic context inclusion of "+e,s.ERROR_CODES.RECURSIVE_CONTEXT_INCLUSION)}return null}async loadImportContext(e){let t=await this.load(e);if(typeof t!="object"||Array.isArray(t))throw new s.ErrorCoded("An imported context must be a single object: "+e,s.ERROR_CODES.INVALID_REMOTE_CONTEXT);if("@import"in t)throw new s.ErrorCoded("An imported context can not import another context: "+e,s.ERROR_CODES.INVALID_CONTEXT_ENTRY);return t=Object.assign({},t),this.containersToHash(t),t}};return u.DEFAULT_PROCESSING_MODE=1.1,Z.ContextParser=u,Z}var Ue={},Ye;function Wt(){return Ye||(Ye=1,Object.defineProperty(Ue,"__esModule",{value:!0})),Ue}var je={},ze;function Yt(){return ze||(ze=1,Object.defineProperty(je,"__esModule",{value:!0})),je}var Qe;function H(){return Qe||(Qe=1,function(d){var s=X&&X.__createBinding||(Object.create?function(g,o,u,r){r===void 0&&(r=u);var e=Object.getOwnPropertyDescriptor(o,u);(!e||("get"in e?!o.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return o[u]}}),Object.defineProperty(g,r,e)}:function(g,o,u,r){r===void 0&&(r=u),g[r]=o[u]}),c=X&&X.__exportStar||function(g,o){for(var u in g)u!=="default"&&!Object.prototype.hasOwnProperty.call(o,u)&&s(o,g,u)};Object.defineProperty(d,"__esModule",{value:!0}),c(Xt(),d),c(Re(),d),c(Ot(),d),c(Wt(),d),c(Yt(),d),c(xt(),d),c(Ke(),d)}(X)),X}var re={},ne={},ie={},ae={},Ze;function zt(){if(Ze)return ae;Ze=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.ContainerHandlerIdentifier=void 0;let d=class{canCombineWithGraph(){return!0}async handle(c,g,o,u,r,e){let t;if(g.emittedStack[e+1]&&g.idStack[e+1])t=g.idStack[e+1][0];else{const l=await o.getContainerKey(u[e],u,e)!==null?await o.resourceToTerm(await g.getContext(u),u[e]):o.dataFactory.blankNode();if(!l){g.emittedStack[e]=!1;return}t=l,g.idStack[e+1]=[t]}let n=g.idStack[e];n||(n=g.idStack[e]=[]),n.some(a=>a.equals(t))||n.push(t),await g.handlePendingContainerFlushBuffers()||(g.emittedStack[e]=!1)}};return ae.ContainerHandlerIdentifier=d,ae}var se={},oe={},et;function Se(){if(et)return oe;et=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.EntryHandlerPredicate=void 0;const d=H(),s=Y();let c=class mt{static async handlePredicateObject(o,u,r,e,t,n,a,l,E){const f=await u.getPropertiesDepth(r,e),p=await u.getDepthOffsetGraph(e,r),h=e-p,x=o.idStack[f];if(x&&!E)for(const O of x)if(p>=0){const I=o.idStack[h-1];if(I)for(const v of I)u.emitQuadChecked(e,O,t,n,v,a,l);else a?(u.validateReverseSubject(n),o.getUnidentifiedGraphBufferSafe(h-1).push({subject:n,predicate:t,object:O,isEmbedded:l})):o.getUnidentifiedGraphBufferSafe(h-1).push({subject:O,predicate:t,object:n,isEmbedded:l})}else{const I=await u.getGraphContainerValue(r,f);u.emitQuadChecked(e,O,t,n,I,a,l)}else if(a&&u.validateReverseSubject(n),E){if(o.rdfstar){o.idStack[e]&&o.emitError(new d.ErrorCoded(`Found an illegal @id inside an annotation: ${o.idStack[e][0].value}`,d.ERROR_CODES.INVALID_ANNOTATION));for(let I=0;I<e;I++)await u.unaliasKeyword(r[I],r,I)==="@id"&&o.emitError(new d.ErrorCoded("Found an illegal annotation inside an embedded node",d.ERROR_CODES.INVALID_ANNOTATION));const O=o.getAnnotationsBufferSafe(f),S={predicate:t,object:n,reverse:a,nestedAnnotations:[],depth:f};O.push(S);for(let I=O.length-2;I>=0;I--){const v=O[I];v.depth>f&&(S.nestedAnnotations.push(v),O.splice(I,1))}}}else o.getUnidentifiedValueBufferSafe(f).push({predicate:t,object:n,reverse:a,isEmbedded:l})}isPropertyHandler(){return!0}isStackProcessor(){return!0}async validate(o,u,r,e,t){const n=r[e];if(n){const a=await o.getContext(r);if(!o.jsonLiteralStack[e]&&await u.predicateToTerm(a,r[e]))return s.Util.getContextValueType(a,n)==="@json"&&(o.jsonLiteralStack[e+1]=!0),!0}return!1}async test(o,u,r,e,t){return e[t]}async handle(o,u,r,e,t,n,a){const l=e[n],E=await o.getContext(e),f=await u.predicateToTerm(E,r);if(f){const p=await u.valueToTerm(E,r,t,n,e);if(p.length)for(let h of p){let x=await u.unaliasKeywordParent(e,n);const O=s.Util.isPropertyReverse(E,l,x);let S=0;for(;x==="@reverse"||typeof x=="number";)typeof x=="number"?S++:n--,x=await u.unaliasKeywordParent(e,n-S);const I=s.Util.isPropertyInEmbeddedNode(x);u.validateReverseInEmbeddedNode(r,O,I);const v=s.Util.isPropertyInAnnotationObject(x);if(t){const w="@list"in s.Util.getContextValueContainer(E,r);if(w||t["@list"]){if((w&&!Array.isArray(t)&&!t["@list"]||t["@list"]&&!Array.isArray(t["@list"]))&&h!==u.rdfNil){const C=u.dataFactory.blankNode();o.emitQuad(n,u.dataFactory.quad(C,u.rdfRest,u.rdfNil,u.getDefaultGraph())),o.emitQuad(n,u.dataFactory.quad(C,u.rdfFirst,h,u.getDefaultGraph())),h=C}if(O&&!o.allowSubjectList)throw new d.ErrorCoded(`Found illegal list value in subject position at ${r}`,d.ERROR_CODES.INVALID_REVERSE_PROPERTY_VALUE)}}await mt.handlePredicateObject(o,u,e,n,f,h,O,I,v)}}}};return oe.EntryHandlerPredicate=c,oe}var tt;function Qt(){if(tt)return se;tt=1,Object.defineProperty(se,"__esModule",{value:!0}),se.ContainerHandlerIndex=void 0;const d=H(),s=Se(),c=Y();let g=class{canCombineWithGraph(){return!0}async handle(u,r,e,t,n,a){if(!Array.isArray(n)){const l="@graph"in u,E=await r.getContext(t),f=t[a-1],p=c.Util.getContextValueIndex(E,f);if(p){if(d.Util.isPotentialKeyword(p))throw new d.ErrorCoded(`Keywords can not be used as @index value, got: ${p}`,d.ERROR_CODES.INVALID_TERM_DEFINITION);if(typeof p!="string")throw new d.ErrorCoded(`@index values must be strings, got: ${p}`,d.ERROR_CODES.INVALID_TERM_DEFINITION);if(typeof n!="object"){if(c.Util.getContextValueType(E,f)!=="@id")throw new d.ErrorCoded(`Property-based index containers require nodes as values or strings with @type: @id, but got: ${n}`,d.ERROR_CODES.INVALID_VALUE_OBJECT);const O=e.resourceToTerm(E,n);O&&(r.idStack[a+1]=[O])}const x=e.createVocabOrBaseTerm(E,p);if(x){const O=await e.valueToTerm(E,p,await e.getContainerKey(t[a],t,a),a,t);if(l){const S=await e.getGraphContainerValue(t,a+1);for(const I of O)r.emitQuad(a,e.dataFactory.quad(S,x,I,e.getDefaultGraph()))}else for(const S of O)await s.EntryHandlerPredicate.handlePredicateObject(r,e,t,a+1,x,S,!1,!1,!1)}}const h=l?2:1;await r.newOnValueJob(t.slice(0,t.length-h),n,a-h,!0),await r.handlePendingContainerFlushBuffers()}r.emittedStack[a]=!1}};return se.ContainerHandlerIndex=g,se}var le={},rt;function Zt(){if(rt)return le;rt=1,Object.defineProperty(le,"__esModule",{value:!0}),le.ContainerHandlerLanguage=void 0;const d=H();let s=class{canCombineWithGraph(){return!1}async handle(g,o,u,r,e,t){const n=await u.getContainerKey(r[t],r,t);if(Array.isArray(e))e=e.map(a=>({"@value":a,"@language":n}));else{if(typeof e!="string")throw new d.ErrorCoded(`Got invalid language map value, got '${JSON.stringify(e)}', but expected string`,d.ERROR_CODES.INVALID_LANGUAGE_MAP_VALUE);e={"@value":e,"@language":n}}await o.newOnValueJob(r.slice(0,r.length-1),e,t-1,!0),o.emittedStack[t]=!1}};return le.ContainerHandlerLanguage=s,le}var de={},nt;function er(){if(nt)return de;nt=1,Object.defineProperty(de,"__esModule",{value:!0}),de.ContainerHandlerType=void 0;const d=Se(),s=Y();let c=class{canCombineWithGraph(){return!1}async handle(o,u,r,e,t,n){if(!Array.isArray(t)){if(typeof t=="string"){const E=await u.getContext(e),p=s.Util.getContextValueType(E,e[n-1])==="@vocab"?await r.createVocabOrBaseTerm(E,t):await r.resourceToTerm(E,t);if(p){const h={"@id":p.termType==="NamedNode"?p.value:t};await u.newOnValueJob(e.slice(0,e.length-1),h,n-1,!0),u.idStack[n+1]=[p]}}else{const E=!!u.idStack[n+1];E||delete u.idStack[n],await u.newOnValueJob(e.slice(0,e.length-1),t,n-1,!0),E||(u.idStack[n+1]=u.idStack[n])}const a=await r.getContainerKey(e[n],e,n),l=a!==null?r.createVocabOrBaseTerm(await u.getContext(e),a):null;l&&await d.EntryHandlerPredicate.handlePredicateObject(u,r,e,n+1,r.rdfType,l,!1,!1,!1),await u.handlePendingContainerFlushBuffers()}u.emittedStack[n]=!1}};return de.ContainerHandlerType=c,de}var it;function Tt(){if(it)return ie;it=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.EntryHandlerContainer=void 0;const d=zt(),s=Qt(),c=Zt(),g=er(),o=Y();let u=class M{static isSimpleGraphContainer(e){return"@graph"in e&&("@set"in e&&Object.keys(e).length===2||Object.keys(e).length===1)}static isComplexGraphContainer(e){return"@graph"in e&&("@set"in e&&Object.keys(e).length>2||!("@set"in e)&&Object.keys(e).length>1)}static getContainerGraphIndex(e,t,n){let a=M.isSimpleGraphContainer(e),l="";for(let E=t;E<n.length;E++)(!a||typeof n[E]=="number")&&(l+=":"+n[E]),!a&&typeof n[E]!="number"&&(a=!0);return l}static async getContainerHandler(e,t,n){const a={containers:{"@set":!0},depth:n,fallback:!0};let l=!1;const E=await e.getContext(t,2);for(let f=n-1;f>=0;f--)if(typeof t[f]!="number"){const p=o.Util.getContextValue(E,"@container",t[f],!1);if(p&&M.isSimpleGraphContainer(p))return{containers:p,depth:f+1,fallback:!1};const h=o.Util.getContextValue(E,"@container",t[f-1],!1);if(h){const x="@graph"in h;for(const O in M.CONTAINER_HANDLERS)if(h[O])return x?M.CONTAINER_HANDLERS[O].canCombineWithGraph()?{containers:h,depth:f,fallback:!1}:a:l?a:{containers:h,depth:f,fallback:!1};return a}else{if(l)return a;l=!0}}return a}static async isBufferableContainerHandler(e,t,n){const a=await M.getContainerHandler(e,t,n);return!a.fallback&&!("@graph"in a.containers)}isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(e,t,n,a,l){return!!await this.test(e,t,null,n,a)}async test(e,t,n,a,l){const E=o.Util.getContextValueContainer(await e.getContext(a,2),a[l-1]);for(const f in M.CONTAINER_HANDLERS)if(E[f])return{containers:E,handler:M.CONTAINER_HANDLERS[f]};return null}async handle(e,t,n,a,l,E,f){return f.handler.handle(f.containers,e,t,a,l,E)}};return u.CONTAINER_HANDLERS={"@id":new d.ContainerHandlerIdentifier,"@index":new s.ContainerHandlerIndex,"@language":new c.ContainerHandlerLanguage,"@type":new g.ContainerHandlerType},ie.EntryHandlerContainer=u,ie}var at;function Y(){if(at)return ne;at=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.Util=void 0;const d=H(),s=Jt(),c=Tt(),g=$t();let o=class V{constructor(r){this.parsingContext=r.parsingContext,this.dataFactory=r.dataFactory||new s.DataFactory,this.rdfFirst=this.dataFactory.namedNode(V.RDF+"first"),this.rdfRest=this.dataFactory.namedNode(V.RDF+"rest"),this.rdfNil=this.dataFactory.namedNode(V.RDF+"nil"),this.rdfType=this.dataFactory.namedNode(V.RDF+"type"),this.rdfJson=this.dataFactory.namedNode(V.RDF+"JSON")}static getContextValue(r,e,t,n){const a=r.getContextRaw()[t];if(!a)return n;const l=a[e];return l===void 0?n:l}static getContextValueContainer(r,e){return V.getContextValue(r,"@container",e,{"@set":!0})}static getContextValueType(r,e){const t=V.getContextValue(r,"@type",e,null);return t==="@none"?null:t}static getContextValueLanguage(r,e){return V.getContextValue(r,"@language",e,r.getContextRaw()["@language"]||null)}static getContextValueDirection(r,e){return V.getContextValue(r,"@direction",e,r.getContextRaw()["@direction"]||null)}static isContextValueReverse(r,e){return!!V.getContextValue(r,"@reverse",e,null)}static getContextValueIndex(r,e){return V.getContextValue(r,"@index",e,r.getContextRaw()["@index"]||null)}static isPropertyReverse(r,e,t){return t==="@reverse"!==V.isContextValueReverse(r,e)}static isPropertyInEmbeddedNode(r){return r==="@id"}static isPropertyInAnnotationObject(r){return r==="@annotation"}static isValidIri(r){return r!==null&&d.Util.isValidIri(r)}static isPrefixArray(r,e){if(r.length>e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}async validateValueIndexes(r){if(this.parsingContext.validateValueIndexes){const e={};for(const t of r)if(t&&typeof t=="object"){const n=t["@id"],a=t["@index"];if(n&&a){const l=e[n];if(l&&l!==a)throw new d.ErrorCoded(`Conflicting @index value for ${n}`,d.ERROR_CODES.CONFLICTING_INDEXES);e[n]=a}}}}async valueToTerm(r,e,t,n,a){if(V.getContextValueType(r,e)==="@json")return[this.dataFactory.literal(this.valueToJsonString(t),this.rdfJson)];const l=typeof t;switch(l){case"object":if(t==null)return[];if(Array.isArray(t))return"@list"in V.getContextValueContainer(r,e)?t.length===0?[this.rdfNil]:this.parsingContext.idStack[n+1]||[]:(await this.validateValueIndexes(t),[]);if(r=await this.getContextSelfOrPropertyScoped(r,e),"@context"in t&&(r=await this.parsingContext.parseContext(t["@context"],(await this.parsingContext.getContext(a,0)).getContextRaw())),t=await this.unaliasKeywords(t,a,n,r),"@value"in t){let E,f,p,h,x;for(e in t){const O=t[e];switch(e){case"@value":E=O;break;case"@language":f=O;break;case"@direction":p=O;break;case"@type":h=O;break;case"@index":x=O;break;case"@annotation":break;default:throw new d.ErrorCoded(`Unknown value entry '${e}' in @value: ${JSON.stringify(t)}`,d.ERROR_CODES.INVALID_VALUE_OBJECT)}}if(await this.unaliasKeyword(h,a,n,!0,r)==="@json")return[this.dataFactory.literal(this.valueToJsonString(E),this.rdfJson)];if(E===null)return[];if(typeof E=="object")throw new d.ErrorCoded(`The value of an '@value' can not be an object, got '${JSON.stringify(E)}'`,d.ERROR_CODES.INVALID_VALUE_OBJECT_VALUE);if(this.parsingContext.validateValueIndexes&&x&&typeof x!="string")throw new d.ErrorCoded(`The value of an '@index' must be a string, got '${JSON.stringify(x)}'`,d.ERROR_CODES.INVALID_INDEX_VALUE);if(f){if(typeof E!="string")throw new d.ErrorCoded(`When an '@language' is set, the value of '@value' must be a string, got '${JSON.stringify(E)}'`,d.ERROR_CODES.INVALID_LANGUAGE_TAGGED_VALUE);if(!d.ContextParser.validateLanguage(f,this.parsingContext.strictValues,d.ERROR_CODES.INVALID_LANGUAGE_TAGGED_STRING))return[];(this.parsingContext.normalizeLanguageTags||this.parsingContext.activeProcessingMode===1)&&(f=f.toLowerCase())}if(p){if(typeof E!="string")throw new Error(`When an '@direction' is set, the value of '@value' must be a string, got '${JSON.stringify(E)}'`);if(!d.ContextParser.validateDirection(p,this.parsingContext.strictValues))return[]}if(f&&p&&this.parsingContext.rdfDirection){if(h)throw new d.ErrorCoded(`Can not have '@language', '@direction' and '@type' in a value: '${JSON.stringify(t)}'`,d.ERROR_CODES.INVALID_VALUE_OBJECT);return this.nullableTermToArray(this.createLanguageDirectionLiteral(n,E,f,p))}else if(f){if(h)throw new d.ErrorCoded(`Can not have both '@language' and '@type' in a value: '${JSON.stringify(t)}'`,d.ERROR_CODES.INVALID_VALUE_OBJECT);return[this.dataFactory.literal(E,f)]}else if(p&&this.parsingContext.rdfDirection){if(h)throw new d.ErrorCoded(`Can not have both '@direction' and '@type' in a value: '${JSON.stringify(t)}'`,d.ERROR_CODES.INVALID_VALUE_OBJECT);return this.nullableTermToArray(this.createLanguageDirectionLiteral(n,E,f,p))}else if(h){if(typeof h!="string")throw new d.ErrorCoded(`The value of an '@type' must be a string, got '${JSON.stringify(h)}'`,d.ERROR_CODES.INVALID_TYPED_VALUE);const O=this.createVocabOrBaseTerm(r,h);if(!O)throw new d.ErrorCoded(`Invalid '@type' value, got '${JSON.stringify(h)}'`,d.ERROR_CODES.INVALID_TYPED_VALUE);if(O.termType!=="NamedNode")throw new d.ErrorCoded(`Illegal value type (${O.termType}): ${h}`,d.ERROR_CODES.INVALID_TYPED_VALUE);return[this.dataFactory.literal(E,O)]}return await this.valueToTerm(new d.JsonLdContextNormalized({}),e,E,n,a)}else if("@set"in t){if(Object.keys(t).length>1)throw new d.ErrorCoded(`Found illegal neighbouring entries next to @set for key: '${e}'`,d.ERROR_CODES.INVALID_SET_OR_LIST_OBJECT);return[]}else if("@list"in t){if(Object.keys(t).length>1)throw new d.ErrorCoded(`Found illegal neighbouring entries next to @list for key: '${e}'`,d.ERROR_CODES.INVALID_SET_OR_LIST_OBJECT);const E=t["@list"];return Array.isArray(E)?E.length===0?[this.rdfNil]:this.parsingContext.idStack[n+1]||[]:await this.valueToTerm(await this.parsingContext.getContext(a),e,E,n-1,a.slice(0,-1))}else{if("@reverse"in t&&typeof t["@reverse"]=="boolean")return[];if("@graph"in V.getContextValueContainer(await this.parsingContext.getContext(a),e)){const E=this.parsingContext.graphContainerTermStack[n+1];return E?Object.values(E):[this.dataFactory.blankNode()]}else if("@id"in t){if(Object.keys(t).length>1&&(r=await this.parsingContext.getContext(a,0)),"@context"in t&&(r=await this.parsingContext.parseContext(t["@context"],r.getContextRaw())),t["@type"]==="@vocab")return this.nullableTermToArray(this.createVocabOrBaseTerm(r,t["@id"]));{const E=t["@id"];let f;if(typeof E=="object")if(this.parsingContext.rdfstar)f=this.parsingContext.idStack[n+1][0];else throw new d.ErrorCoded(`Found illegal @id '${t}'`,d.ERROR_CODES.INVALID_ID_VALUE);else f=this.resourceToTerm(r,E);return this.nullableTermToArray(f)}}else return this.parsingContext.emittedStack[n+1]||t&&typeof t=="object"&&Object.keys(t).length===0?this.parsingContext.idStack[n+1]||(this.parsingContext.idStack[n+1]=[this.dataFactory.blankNode()]):[]}case"string":return this.nullableTermToArray(this.stringValueToTerm(n,await this.getContextSelfOrPropertyScoped(r,e),e,t,null));case"boolean":return this.nullableTermToArray(this.stringValueToTerm(n,await this.getContextSelfOrPropertyScoped(r,e),e,(!!t).toString(),this.dataFactory.namedNode(V.XSD_BOOLEAN)));case"number":return this.nullableTermToArray(this.stringValueToTerm(n,await this.getContextSelfOrPropertyScoped(r,e),e,t,this.dataFactory.namedNode(t%1===0&&t<1e21?V.XSD_INTEGER:V.XSD_DOUBLE)));default:return this.parsingContext.emitError(new Error(`Could not determine the RDF type of a ${l}`)),[]}}async getContextSelfOrPropertyScoped(r,e){const t=r.getContextRaw()[e];return t&&typeof t=="object"&&"@context"in t&&(r=await this.parsingContext.parseContext(t,r.getContextRaw(),!0)),r}nullableTermToArray(r){return r?[r]:[]}predicateToTerm(r,e){const t=r.expandTerm(e,!0,this.parsingContext.getExpandOptions());if(!t)return null;if(t[0]==="_"&&t[1]===":")return this.parsingContext.produceGeneralizedRdf?this.dataFactory.blankNode(t.substr(2)):null;if(V.isValidIri(t))return this.dataFactory.namedNode(t);if(t&&this.parsingContext.strictValues)this.parsingContext.emitError(new d.ErrorCoded(`Invalid predicate IRI: ${t}`,d.ERROR_CODES.INVALID_IRI_MAPPING));else return null;return null}resourceToTerm(r,e){if(e.startsWith("_:"))return this.dataFactory.blankNode(e.substr(2));const t=r.expandTerm(e,!1,this.parsingContext.getExpandOptions());if(!V.isValidIri(t))if(t&&this.parsingContext.strictValues)this.parsingContext.emitError(new Error(`Invalid resource IRI: ${t}`));else return null;return this.dataFactory.namedNode(t)}createVocabOrBaseTerm(r,e){if(e.startsWith("_:"))return this.dataFactory.blankNode(e.substr(2));const t=this.parsingContext.getExpandOptions();let n=r.expandTerm(e,!0,t);if(n===e&&(n=r.expandTerm(e,!1,t)),!V.isValidIri(n))if(n&&this.parsingContext.strictValues&&!n.startsWith("@"))this.parsingContext.emitError(new Error(`Invalid term IRI: ${n}`));else return null;return this.dataFactory.namedNode(n)}intToString(r,e){return typeof r=="number"?Number.isFinite(r)?r%1===0&&(!e||e.value!==V.XSD_DOUBLE)?Number(r).toString():r.toExponential(15).replace(/(\d)0*e\+?/,"$1E"):r>0?"INF":"-INF":r}stringValueToTerm(r,e,t,n,a){const l=V.getContextValueType(e,t);if(l)if(l==="@id"){if(!a)return this.resourceToTerm(e,this.intToString(n,a))}else if(l==="@vocab"){if(!a)return this.createVocabOrBaseTerm(e,this.intToString(n,a))}else a=this.dataFactory.namedNode(l);if(!a){const E=V.getContextValueLanguage(e,t),f=V.getContextValueDirection(e,t);return f&&this.parsingContext.rdfDirection?this.createLanguageDirectionLiteral(r,this.intToString(n,a),E,f):this.dataFactory.literal(this.intToString(n,a),E)}return this.dataFactory.literal(this.intToString(n,a),a)}createLanguageDirectionLiteral(r,e,t,n){if(this.parsingContext.rdfDirection==="i18n-datatype")return t||(t=""),this.dataFactory.literal(e,this.dataFactory.namedNode(`https://www.w3.org/ns/i18n#${t}_${n}`));{const a=this.dataFactory.blankNode(),l=this.getDefaultGraph();return this.parsingContext.emitQuad(r,this.dataFactory.quad(a,this.dataFactory.namedNode(V.RDF+"value"),this.dataFactory.literal(e),l)),t&&this.parsingContext.emitQuad(r,this.dataFactory.quad(a,this.dataFactory.namedNode(V.RDF+"language"),this.dataFactory.literal(t),l)),this.parsingContext.emitQuad(r,this.dataFactory.quad(a,this.dataFactory.namedNode(V.RDF+"direction"),this.dataFactory.literal(n),l)),a}}valueToJsonString(r){return g(r)}async unaliasKeyword(r,e,t,n,a){if(Number.isInteger(r))return r;if(!n){const l=this.parsingContext.unaliasedKeywordCacheStack[t];if(l)return l}if(!d.Util.isPotentialKeyword(r)){a=a||await this.parsingContext.getContext(e);let l=a.getContextRaw()[r];l&&typeof l=="object"&&(l=l["@id"]),d.Util.isValidKeyword(l)&&(r=l)}return n?r:this.parsingContext.unaliasedKeywordCacheStack[t]=r}async unaliasKeywordParent(r,e){return await this.unaliasKeyword(e>0&&r[e-1],r,e-1)}async unaliasKeywords(r,e,t,n){const a={};for(const l in r)a[await this.unaliasKeyword(l,e,t+1,!0,n)]=r[l];return a}async isLiteral(r,e){for(let t=e;t>=0;t--){if(await this.unaliasKeyword(r[t],r,t)==="@annotation")return!1;if(this.parsingContext.literalStack[t]||this.parsingContext.jsonLiteralStack[t])return!0}return!1}async getDepthOffsetGraph(r,e){for(let t=r-1;t>0;t--)if(await this.unaliasKeyword(e[t],e,t)==="@graph"){const n=(await c.EntryHandlerContainer.getContainerHandler(this.parsingContext,e,t)).containers;return c.EntryHandlerContainer.isComplexGraphContainer(n)?-1:r-t-1}return-1}validateReverseSubject(r){if(r.termType==="Literal")throw new d.ErrorCoded(`Found illegal literal in subject position: ${r.value}`,d.ERROR_CODES.INVALID_REVERSE_PROPERTY_VALUE)}getDefaultGraph(){return this.parsingContext.defaultGraph||this.dataFactory.defaultGraph()}async getGraphContainerValue(r,e){let t=this.getDefaultGraph();const{containers:n,depth:a}=await c.EntryHandlerContainer.getContainerHandler(this.parsingContext,r,e);if("@graph"in n){const l=c.EntryHandlerContainer.getContainerGraphIndex(n,a,r),E=this.parsingContext.graphContainerTermStack[a];if(t=E?E[l]:null,!t){let f=null;if("@id"in n){const p=await this.getContainerKey(r[a],r,a);p!==null&&(f=await this.resourceToTerm(await this.parsingContext.getContext(r),p))}f||(f=this.dataFactory.blankNode()),this.parsingContext.graphContainerTermStack[a]||(this.parsingContext.graphContainerTermStack[a]={}),t=this.parsingContext.graphContainerTermStack[a][l]=f}}return t}async getPropertiesDepth(r,e){let t=e;for(let n=e-1;n>0;n--)if(typeof r[n]!="number"){const a=await this.unaliasKeyword(r[n],r,n);if(a==="@reverse")return n;if(a==="@nest")t=n;else return t}return t}async getContainerKey(r,e,t){const n=await this.unaliasKeyword(r,e,t);return n==="@none"?null:n}validateReverseInEmbeddedNode(r,e,t){if(t&&e&&!this.parsingContext.rdfstarReverseInEmbedded)throw new d.ErrorCoded(`Illegal reverse property in embedded node in ${r}`,d.ERROR_CODES.INVALID_EMBEDDED_NODE)}emitQuadChecked(r,e,t,n,a,l,E){let f;if(l?(this.validateReverseSubject(n),f=this.dataFactory.quad(n,t,e,a)):f=this.dataFactory.quad(e,t,n,a),E){if(f.graph.termType!=="DefaultGraph"&&(f=this.dataFactory.quad(f.subject,f.predicate,f.object)),this.parsingContext.idStack[r-1])throw new d.ErrorCoded("Illegal multiple properties in an embedded node",d.ERROR_CODES.INVALID_EMBEDDED_NODE);this.parsingContext.idStack[r-1]=[f]}else this.parsingContext.emitQuad(r,f);const p=this.parsingContext.annotationsBuffer[r];if(p){for(const h of p)this.emitAnnotation(r,f,h);delete this.parsingContext.annotationsBuffer[r]}}emitAnnotation(r,e,t){let n;t.reverse?(this.validateReverseSubject(t.object),n=this.dataFactory.quad(t.object,t.predicate,e)):n=this.dataFactory.quad(e,t.predicate,t.object),this.parsingContext.emitQuad(r,n);for(const a of t.nestedAnnotations)this.emitAnnotation(r,n,a)}};return o.XSD="http://www.w3.org/2001/XMLSchema#",o.XSD_BOOLEAN=o.XSD+"boolean",o.XSD_INTEGER=o.XSD+"integer",o.XSD_DOUBLE=o.XSD+"double",o.RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#",ne.Util=o,ne}var st;function tr(){if(st)return re;st=1,Object.defineProperty(re,"__esModule",{value:!0}),re.EntryHandlerArrayValue=void 0;const d=Y(),s=H();let c=class{isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(o,u,r,e,t){return this.test(o,u,null,r,e)}async test(o,u,r,e,t){return typeof e[t]=="number"}async handle(o,u,r,e,t,n){let a=await u.unaliasKeywordParent(e,n);if(a==="@list"){let l=null,E=0;for(let f=n-2;f>0;f--){const p=e[f];if(typeof p=="string"||typeof p=="number"){E=f,l=p;break}}if(l!==null){const f=await u.valueToTerm(await o.getContext(e),l,t,n,e);for(const p of f)await this.handleListElement(o,u,p,t,n,e.slice(0,E),E);f.length===0&&await this.handleListElement(o,u,null,t,n,e.slice(0,E),E)}}else if(a==="@set")await o.newOnValueJob(e.slice(0,-2),t,n-2,!1);else if(a!==void 0&&a!=="@type"){for(let E=n-1;E>0;E--)if(typeof e[E]!="number"){a=await u.unaliasKeyword(e[E],e,E);break}const l=await o.getContext(e.slice(0,-1));if("@list"in d.Util.getContextValueContainer(l,a)){o.emittedStack[n+1]=!0;const E=await u.valueToTerm(await o.getContext(e),a,t,n,e);for(const f of E)await this.handleListElement(o,u,f,t,n,e.slice(0,-1),n-1);E.length===0&&await this.handleListElement(o,u,null,t,n,e.slice(0,-1),n-1)}else o.shiftStack(n,1),await o.newOnValueJob(e.slice(0,-1),t,n-1,!1),o.contextTree.removeContext(e.slice(0,-1))}}async handleListElement(o,u,r,e,t,n,a){let l=o.listPointerStack[t];if(e!==null&&(await u.unaliasKeywords(e,n,t))["@value"]!==null){if(!l||!l.value){const E=u.dataFactory.blankNode();l={value:E,listRootDepth:a,listId:E}}else{const E=u.dataFactory.blankNode();o.emitQuad(t,u.dataFactory.quad(l.value,u.rdfRest,E,u.getDefaultGraph())),l.value=E}r&&o.emitQuad(t,u.dataFactory.quad(l.value,u.rdfFirst,r,u.getDefaultGraph()))}else l||(l={listRootDepth:a,listId:u.rdfNil});o.listPointerStack[t]=l,o.rdfstar&&o.annotationsBuffer[t]&&o.emitError(new s.ErrorCoded("Found an illegal annotation inside a list",s.ERROR_CODES.INVALID_ANNOTATION))}};return re.EntryHandlerArrayValue=c,re}var ce={},ot;function rr(){if(ot)return ce;ot=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.EntryHandlerInvalidFallback=void 0;let d=class{isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(c,g,o,u,r){return!1}async test(c,g,o,u,r){return!0}async handle(c,g,o,u,r,e){c.emittedStack[e]=!1}};return ce.EntryHandlerInvalidFallback=d,ce}var fe={},ue={},lt;function J(){if(lt)return ue;lt=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.EntryHandlerKeyword=void 0;let d=class{constructor(c){this.keyword=c}isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(c,g,o,u,r){return!1}async test(c,g,o,u,r){return o===this.keyword}};return ue.EntryHandlerKeyword=d,ue}var dt;function nr(){if(dt)return fe;dt=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.EntryHandlerKeywordContext=void 0;const d=H(),s=J();let c=class extends s.EntryHandlerKeyword{constructor(){super("@context")}isStackProcessor(){return!1}async handle(o,u,r,e,t,n){o.streamingProfile&&(o.processingStack[n]||o.processingType[n]||o.idStack[n]!==void 0)&&o.emitError(new d.ErrorCoded("Found an out-of-order context, while streaming is enabled.(disable `streamingProfile`)",d.ERROR_CODES.INVALID_STREAMING_KEY_ORDER));const a=o.getContext(e),l=o.parseContext(t,(await a).getContextRaw());o.contextTree.setContext(e.slice(0,-1),l),o.emitContext(t),await o.validateContext(await l)}};return fe.EntryHandlerKeywordContext=c,fe}var he={},ct;function ir(){if(ct)return he;ct=1,Object.defineProperty(he,"__esModule",{value:!0}),he.EntryHandlerKeywordGraph=void 0;const d=J();let s=class extends d.EntryHandlerKeyword{constructor(){super("@graph")}async handle(g,o,u,r,e,t){g.graphStack[t+1]=!0}};return he.EntryHandlerKeywordGraph=s,he}var ye={},ft;function ar(){if(ft)return ye;ft=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.EntryHandlerKeywordId=void 0;const d=H(),s=J();let c=class extends s.EntryHandlerKeyword{constructor(){super("@id")}isStackProcessor(){return!1}async handle(o,u,r,e,t,n){if(typeof t!="string"){if(o.rdfstar&&typeof t=="object"){const l=Object.keys(t);l.length===1&&l[0]==="@id"&&o.emitError(new d.ErrorCoded(`Invalid embedded node without property with @id ${t["@id"]}`,d.ERROR_CODES.INVALID_EMBEDDED_NODE))}else o.emitError(new d.ErrorCoded(`Found illegal @id '${t}'`,d.ERROR_CODES.INVALID_ID_VALUE));return}const a=await u.getPropertiesDepth(e,n);if(o.idStack[a]!==void 0&&(o.idStack[a][0].listHead?o.emitError(new d.ErrorCoded(`Found illegal neighbouring entries next to @list for key: '${e[n-1]}'`,d.ERROR_CODES.INVALID_SET_OR_LIST_OBJECT)):o.emitError(new d.ErrorCoded(`Found duplicate @ids '${o.idStack[a][0].value}' and '${t}'`,d.ERROR_CODES.COLLIDING_KEYWORDS))),o.rdfstar&&o.annotationsBuffer[n])for(const l of o.annotationsBuffer[n])l.depth===n&&o.emitError(new d.ErrorCoded(`Found an illegal @id inside an annotation: ${t}`,d.ERROR_CODES.INVALID_ANNOTATION));o.idStack[a]=u.nullableTermToArray(await u.resourceToTerm(await o.getContext(e),t))}};return ye.EntryHandlerKeywordId=c,ye}var Ee={},ut;function sr(){if(ut)return Ee;ut=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.EntryHandlerKeywordIncluded=void 0;const d=H(),s=J();let c=class extends s.EntryHandlerKeyword{constructor(){super("@included")}async handle(o,u,r,e,t,n){typeof t!="object"&&o.emitError(new d.ErrorCoded(`Found illegal @included '${t}'`,d.ERROR_CODES.INVALID_INCLUDED_VALUE));const a=await u.unaliasKeywords(t,e,n,await o.getContext(e));"@value"in a&&o.emitError(new d.ErrorCoded(`Found an illegal @included @value node '${JSON.stringify(t)}'`,d.ERROR_CODES.INVALID_INCLUDED_VALUE)),"@list"in a&&o.emitError(new d.ErrorCoded(`Found an illegal @included @list node '${JSON.stringify(t)}'`,d.ERROR_CODES.INVALID_INCLUDED_VALUE)),o.emittedStack[n]=!1}};return Ee.EntryHandlerKeywordIncluded=c,Ee}var ge={},ht;function or(){if(ht)return ge;ht=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.EntryHandlerKeywordNest=void 0;const d=H(),s=J();let c=class extends s.EntryHandlerKeyword{constructor(){super("@nest")}async handle(o,u,r,e,t,n){typeof t!="object"&&o.emitError(new d.ErrorCoded(`Found invalid @nest entry for '${r}': '${t}'`,d.ERROR_CODES.INVALID_NEST_VALUE)),"@value"in await u.unaliasKeywords(t,e,n,await o.getContext(e))&&o.emitError(new d.ErrorCoded(`Found an invalid @value node for '${r}'`,d.ERROR_CODES.INVALID_NEST_VALUE)),o.emittedStack[n]=!1}};return ge.EntryHandlerKeywordNest=c,ge}var pe={},yt;function lr(){if(yt)return pe;yt=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.EntryHandlerKeywordType=void 0;const d=H(),s=Y(),c=Se(),g=J();let o=class extends g.EntryHandlerKeyword{constructor(){super("@type")}isStackProcessor(){return!1}async handle(r,e,t,n,a,l){const E=n[l],f=await r.getContext(n),p=e.rdfType,h=await e.unaliasKeywordParent(n,l),x=s.Util.isPropertyReverse(f,E,h),O=s.Util.isPropertyInEmbeddedNode(h);e.validateReverseInEmbeddedNode(t,x,O);const S=s.Util.isPropertyInAnnotationObject(h),I=Array.isArray(a)?a:[a];for(const C of I){typeof C!="string"&&r.emitError(new d.ErrorCoded(`Found illegal @type '${C}'`,d.ERROR_CODES.INVALID_TYPE_VALUE));const m=e.createVocabOrBaseTerm(f,C);m&&await c.EntryHandlerPredicate.handlePredicateObject(r,e,n,l,p,m,x,O,S)}let v=Promise.resolve(f),w=!1;for(const C of I.sort()){const m=s.Util.getContextValue(f,"@context",C,null);m&&(w=!0,v=v.then(D=>r.parseContext(m,D.getContextRaw())))}r.streamingProfile&&(w||!r.streamingProfileAllowOutOfOrderPlainType)&&(r.processingStack[l]||r.idStack[l])&&r.emitError(new d.ErrorCoded("Found an out-of-order type-scoped context, while streaming is enabled.(disable `streamingProfile`)",d.ERROR_CODES.INVALID_STREAMING_KEY_ORDER)),w&&(v=v.then(C=>C.getContextRaw()["@propagate"]!==!0?new d.JsonLdContextNormalized(Object.assign(Object.assign({},C.getContextRaw()),{"@propagate":!1,"@__propagateFallback":f.getContextRaw()})):C),r.contextTree.setContext(n.slice(0,n.length-1),v)),r.processingType[l]=!0}};return pe.EntryHandlerKeywordType=o,pe}var we={},Et;function dr(){if(Et)return we;Et=1,Object.defineProperty(we,"__esModule",{value:!0}),we.EntryHandlerKeywordUnknownFallback=void 0;const d=H();let s=class St{isPropertyHandler(){return!1}isStackProcessor(){return!0}async validate(g,o,u,r,e){const t=await o.unaliasKeyword(u[r],u,r);return d.Util.isPotentialKeyword(t)?!(!e&&t==="@list"):!1}async test(g,o,u,r,e){return d.Util.isPotentialKeyword(u)}async handle(g,o,u,r,e,t){const n=St.VALID_KEYWORDS_TYPES[u];n!==void 0?n&&typeof e!==n.type&&g.emitError(new d.ErrorCoded(`Invalid value type for '${u}' with value '${e}'`,n.errorCode)):g.strictValues&&g.emitError(new Error(`Unknown keyword '${u}' with value '${e}'`)),g.emittedStack[t]=!1}};return s.VALID_KEYWORDS_TYPES={"@index":{type:"string",errorCode:d.ERROR_CODES.INVALID_INDEX_VALUE},"@list":null,"@reverse":{type:"object",errorCode:d.ERROR_CODES.INVALID_REVERSE_VALUE},"@set":null,"@value":null},we.EntryHandlerKeywordUnknownFallback=s,we}var Ie={},gt;function cr(){if(gt)return Ie;gt=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.EntryHandlerKeywordValue=void 0;const d=J();let s=class extends d.EntryHandlerKeyword{constructor(){super("@value")}async validate(g,o,u,r,e){const t=u[r];return t&&!g.literalStack[r]&&await this.test(g,o,t,u,r)&&(g.literalStack[r]=!0),super.validate(g,o,u,r,e)}async test(g,o,u,r,e){return await o.unaliasKeyword(r[e],r.slice(0,r.length-1),e-1,!0)==="@value"}async handle(g,o,u,r,e,t){g.literalStack[t]=!0,delete g.unidentifiedValuesBuffer[t],delete g.unidentifiedGraphsBuffer[t],g.emittedStack[t]=!1}};return Ie.EntryHandlerKeywordValue=s,Ie}var Ce={},_e={},pt;function fr(){if(pt)return _e;pt=1,Object.defineProperty(_e,"__esModule",{value:!0}),_e.ContextTree=void 0;let d=class At{constructor(){this.subTrees={}}getContext(c){if(c.length>0){const[g,...o]=c,u=this.subTrees[g];if(u){const r=u.getContext(o);if(r)return r.then(({context:e,depth:t})=>({context:e,depth:t+1}))}}return this.context?this.context.then(g=>({context:g,depth:0})):null}setContext(c,g){if(c.length===0)this.context=g;else{const[o,...u]=c;let r=this.subTrees[o];r||(r=this.subTrees[o]=new At),r.setContext(u,g)}}removeContext(c){this.setContext(c,null)}};return _e.ContextTree=d,_e}var wt;function ur(){if(wt)return Ce;wt=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.ParsingContext=void 0;const d=H(),s=Re(),c=fr(),g=vt();let o=class Nt{constructor(r){this.contextParser=new d.ContextParser({documentLoader:r.documentLoader,skipValidation:r.skipContextValidation}),this.streamingProfile=!!r.streamingProfile,this.baseIRI=r.baseIRI,this.produceGeneralizedRdf=!!r.produceGeneralizedRdf,this.allowSubjectList=!!r.allowSubjectList,this.processingMode=r.processingMode||g.JsonLdParser.DEFAULT_PROCESSING_MODE,this.strictValues=!!r.strictValues,this.validateValueIndexes=!!r.validateValueIndexes,this.defaultGraph=r.defaultGraph,this.rdfDirection=r.rdfDirection,this.normalizeLanguageTags=r.normalizeLanguageTags,this.streamingProfileAllowOutOfOrderPlainType=r.streamingProfileAllowOutOfOrderPlainType,this.rdfstar=r.rdfstar!==!1,this.rdfstarReverseInEmbedded=r.rdfstarReverseInEmbedded,this.topLevelProperties=!1,this.activeProcessingMode=parseFloat(this.processingMode),this.processingStack=[],this.processingType=[],this.emittedStack=[],this.idStack=[],this.graphStack=[],this.graphContainerTermStack=[],this.listPointerStack=[],this.contextTree=new c.ContextTree,this.literalStack=[],this.validationStack=[],this.unaliasedKeywordCacheStack=[],this.jsonLiteralStack=[],this.unidentifiedValuesBuffer=[],this.unidentifiedGraphsBuffer=[],this.annotationsBuffer=[],this.pendingContainerFlushBuffers=[],this.parser=r.parser,r.context?(this.rootContext=this.parseContext(r.context),this.rootContext.then(e=>this.validateContext(e))):this.rootContext=Promise.resolve(new d.JsonLdContextNormalized(this.baseIRI?{"@base":this.baseIRI,"@__baseDocument":!0}:{}))}async parseContext(r,e,t){return this.contextParser.parse(r,{baseIRI:this.baseIRI,ignoreProtection:t,normalizeLanguageTags:this.normalizeLanguageTags,parentContext:e,processingMode:this.activeProcessingMode})}validateContext(r){const e=r.getContextRaw()["@version"];if(e){if(this.activeProcessingMode&&e>this.activeProcessingMode)throw new s.ErrorCoded(`Unsupported JSON-LD version '${e}' under active processing mode ${this.activeProcessingMode}.`,s.ERROR_CODES.PROCESSING_MODE_CONFLICT);if(this.activeProcessingMode&&e<this.activeProcessingMode)throw new s.ErrorCoded(`Invalid JSON-LD version ${e} under active processing mode ${this.activeProcessingMode}.`,s.ERROR_CODES.INVALID_VERSION_VALUE);this.activeProcessingMode=e}}async getContext(r,e=1){const t=r;for(;typeof r[r.length-1]=="number";)r=r.slice(0,r.length-1);e&&(r=r.slice(0,-e));const n=await this.getContextPropagationAware(r);let l=n.context.getContextRaw();for(let E=n.depth;E<t.length-e;E++){const f=t[E],p=l[f];if(p&&typeof p=="object"&&"@context"in p){const h=(await this.parseContext(p,l,!0)).getContextRaw(),x=!(f in h)||h[f]["@context"]["@propagate"];(x!==!1||E===t.length-1-e)&&(l=Object.assign({},h),delete l["@propagate"],l[f]=Object.assign({},l[f]),"@id"in p&&(l[f]["@id"]=p["@id"]),delete l[f]["@context"],x!==!1&&this.contextTree.setContext(t.slice(0,E+e),Promise.resolve(new d.JsonLdContextNormalized(l))))}}return new d.JsonLdContextNormalized(l)}async getContextPropagationAware(r){const e=r.length;let t=null,n;do{n=!1,t&&"@__propagateFallback"in t.context.getContextRaw()?t.context=new d.JsonLdContextNormalized(t.context.getContextRaw()["@__propagateFallback"]):(t&&(r=r.slice(0,t.depth-1)),t=await this.contextTree.getContext(r)||{context:await this.rootContext,depth:0});const a=r[r.length-1];if(a in t.context.getContextRaw()){const l=t.context.getContextRaw()[a];l&&typeof l=="object"&&"@context"in l&&(n=!0)}}while(t.depth>0&&t.context.getContextRaw()["@propagate"]===!1&&t.depth!==e&&!n);return t.depth===0&&t.context.getContextRaw()["@propagate"]===!1&&t.depth!==e&&(t.context=new d.JsonLdContextNormalized({})),t}async newOnValueJob(r,e,t,n){await this.parser.newOnValueJob(r,e,t,n)}async handlePendingContainerFlushBuffers(){if(this.pendingContainerFlushBuffers.length>0){for(const r of this.pendingContainerFlushBuffers)await this.parser.flushBuffer(r.depth,r.keys),this.parser.flushStacks(r.depth);return this.pendingContainerFlushBuffers.splice(0,this.pendingContainerFlushBuffers.length),!0}else return!1}emitQuad(r,e){r===1&&(this.topLevelProperties=!0),this.parser.push(e)}emitError(r){this.parser.emit("error",r)}emitContext(r){this.parser.emit("context",r)}getUnidentifiedValueBufferSafe(r){let e=this.unidentifiedValuesBuffer[r];return e||(e=[],this.unidentifiedValuesBuffer[r]=e),e}getUnidentifiedGraphBufferSafe(r){let e=this.unidentifiedGraphsBuffer[r];return e||(e=[],this.unidentifiedGraphsBuffer[r]=e),e}getAnnotationsBufferSafe(r){let e=this.annotationsBuffer[r];return e||(e=[],this.annotationsBuffer[r]=e),e}getExpandOptions(){return Nt.EXPAND_OPTIONS[this.activeProcessingMode]}shiftStack(r,e){const t=this.idStack[r+e];if(t&&(this.idStack[r]=t,this.emittedStack[r]=!0,delete this.idStack[r+e]),this.pendingContainerFlushBuffers.length)for(const n of this.pendingContainerFlushBuffers)n.depth>=r+e&&(n.depth-=e,n.keys.splice(r,e));this.unidentifiedValuesBuffer[r+e]&&(this.unidentifiedValuesBuffer[r]=this.unidentifiedValuesBuffer[r+e],delete this.unidentifiedValuesBuffer[r+e]),this.annotationsBuffer[r+e-1]&&(this.annotationsBuffer[r-1]||(this.annotationsBuffer[r-1]=[]),this.annotationsBuffer[r-1]=[...this.annotationsBuffer[r-1],...this.annotationsBuffer[r+e-1]],delete this.annotationsBuffer[r+e-1])}};return o.EXPAND_OPTIONS={1:{allowPrefixForcing:!1,allowPrefixNonGenDelims:!1,allowVocabRelativeToBase:!1},1.1:{allowPrefixForcing:!0,allowPrefixNonGenDelims:!1,allowVocabRelativeToBase:!0}},Ce.ParsingContext=o,Ce}var be={},It;function hr(){if(It)return be;It=1,Object.defineProperty(be,"__esModule",{value:!0}),be.EntryHandlerKeywordAnnotation=void 0;const d=J(),s=H();let c=class extends d.EntryHandlerKeyword{constructor(){super("@annotation")}async handle(o,u,r,e,t,n){(typeof t=="string"||typeof t=="object"&&t["@value"])&&o.emitError(new s.ErrorCoded(`Found illegal annotation value: ${JSON.stringify(t)}`,s.ERROR_CODES.INVALID_ANNOTATION))}};return be.EntryHandlerKeywordAnnotation=c,be}var Ct;function vt(){if(Ct)return Q;Ct=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.JsonLdParser=void 0;const d=qt(),s=H(),c=Gt(),g=tr(),o=Tt(),u=rr(),r=Se(),e=nr(),t=ir(),n=ar(),a=sr(),l=or(),E=lr(),f=dr(),p=cr(),h=ur(),x=Y(),O=Rt(),S=hr();let I=class z extends c.Transform{constructor(w){super({readableObjectMode:!0}),w=w||{},this.options=w,this.parsingContext=new h.ParsingContext(Object.assign({parser:this},w)),this.util=new x.Util({dataFactory:w.dataFactory,parsingContext:this.parsingContext}),this.jsonParser=new d,this.contextJobs=[],this.typeJobs=[],this.contextAwaitingJobs=[],this.lastDepth=0,this.lastKeys=[],this.lastOnValueJob=Promise.resolve(),this.attachJsonParserListeners(),this.on("end",()=>{typeof this.jsonParser.mode<"u"&&this.emit("error",new Error("Unclosed document"))})}static fromHttpResponse(w,C,m,D){let y;if(C!=="application/ld+json"){if(C!=="application/json"&&!C.endsWith("+json"))throw new s.ErrorCoded(`Unsupported JSON-LD media type ${C}`,s.ERROR_CODES.LOADING_DOCUMENT_FAILED);if(m&&m.has("Link")&&m.forEach((T,L)=>{if(L==="link"){const P=(0,O.parse)(T);for(const A of P.get("rel","http://www.w3.org/ns/json-ld#context")){if(y)throw new s.ErrorCoded("Multiple JSON-LD context link headers were found on "+w,s.ERROR_CODES.MULTIPLE_CONTEXT_LINK_HEADERS);y=A.uri}}}),!y&&!D?.ignoreMissingContextLinkHeader)throw new s.ErrorCoded(`Missing context link header for media type ${C} on ${w}`,s.ERROR_CODES.LOADING_DOCUMENT_FAILED)}let b;if(m&&m.has("Content-Type")){const T=m.get("Content-Type"),L=/; *profile=([^"]*)/.exec(T);L&&L[1]==="http://www.w3.org/ns/json-ld#streaming"&&(b=!0)}return new z(Object.assign({baseIRI:w,context:y,streamingProfile:b},D||{}))}import(w){if("pipe"in w){w.on("error",m=>C.emit("error",m));const C=w.pipe(new z(this.options));return C}else{const C=new c.PassThrough({readableObjectMode:!0});w.on("error",D=>m.emit("error",D)),w.on("data",D=>C.push(D)),w.on("end",()=>C.push(null));const m=C.pipe(new z(this.options));return m}}_transform(w,C,m){this.jsonParser.write(w),this.lastOnValueJob.then(()=>m(),D=>m(D))}async newOnValueJob(w,C,m,D){let y=!0;if(D&&m<this.lastDepth){const A=this.parsingContext.listPointerStack[this.lastDepth];A&&(A.value&&this.push(this.util.dataFactory.quad(A.value,this.util.rdfRest,this.util.rdfNil,this.util.getDefaultGraph())),A.listId.listHead=!0,this.parsingContext.idStack[A.listRootDepth+1]=[A.listId],this.parsingContext.listPointerStack.splice(this.lastDepth,1)),await o.EntryHandlerContainer.isBufferableContainerHandler(this.parsingContext,this.lastKeys,this.lastDepth)?(this.parsingContext.pendingContainerFlushBuffers.push({depth:this.lastDepth,keys:this.lastKeys.slice(0,this.lastKeys.length)}),y=!1):await this.flushBuffer(this.lastDepth,this.lastKeys)}const b=await this.util.unaliasKeyword(w[m],w,m),T=await this.util.unaliasKeywordParent(w,m);this.parsingContext.emittedStack[m]=!0;let L=!0;s.Util.isValidKeyword(b)&&T==="@reverse"&&b!=="@context"&&this.emit("error",new s.ErrorCoded(`Found the @id '${C}' inside an @reverse property`,s.ERROR_CODES.INVALID_REVERSE_PROPERTY_MAP));let P=!1;this.parsingContext.validationStack.length>1&&(P=this.parsingContext.validationStack[this.parsingContext.validationStack.length-1].property);for(let A=Math.max(1,this.parsingContext.validationStack.length-1);A<w.length-1;A++){const j=this.parsingContext.validationStack[A]||(this.parsingContext.validationStack[A]=await this.validateKey(w.slice(0,A+1),A,P));if(j.valid)!P&&j.property&&(P=!0);else{this.parsingContext.emittedStack[m]=!1,L=!1;break}}if(await this.util.isLiteral(w,m)&&(L=!1),L)for(const A of z.ENTRY_HANDLERS){const j=await A.test(this.parsingContext,this.util,b,w,m);if(j){await A.handle(this.parsingContext,this.util,b,w,C,m,j),A.isStackProcessor()&&(this.parsingContext.processingStack[m]=!0);break}}m===0&&Array.isArray(C)&&await this.util.validateValueIndexes(C),y&&m<this.lastDepth&&this.flushStacks(this.lastDepth),this.lastDepth=m,this.lastKeys=w,this.parsingContext.unaliasedKeywordCacheStack.splice(m-1)}flushStacks(w){this.parsingContext.processingStack.splice(w,1),this.parsingContext.processingType.splice(w,1),this.parsingContext.emittedStack.splice(w,1),this.parsingContext.idStack.splice(w,1),this.parsingContext.graphStack.splice(w+1,1),this.parsingContext.graphContainerTermStack.splice(w,1),this.parsingContext.jsonLiteralStack.splice(w,1),this.parsingContext.validationStack.splice(w-1,2),this.parsingContext.literalStack.splice(w,this.parsingContext.literalStack.length-w),this.parsingContext.annotationsBuffer.splice(w,1)}async flushBuffer(w,C){let m=this.parsingContext.idStack[w];!!m||(m=this.parsingContext.idStack[w]=[this.util.dataFactory.blankNode()]);const y=this.parsingContext.unidentifiedValuesBuffer[w];if(y){for(const L of m){const P=await this.util.getDepthOffsetGraph(w,C),A=this.parsingContext.graphStack[w]||P>=0?this.parsingContext.idStack[w-P-1]:[await this.util.getGraphContainerValue(C,w)];if(A)for(const j of A){this.parsingContext.emittedStack[w]=!0;for(const U of y)this.util.emitQuadChecked(w,L,U.predicate,U.object,j,U.reverse,U.isEmbedded)}else{const j=this.parsingContext.getUnidentifiedGraphBufferSafe(w-await this.util.getDepthOffsetGraph(w,C)-1);for(const U of y)U.reverse?j.push({object:L,predicate:U.predicate,subject:U.object,isEmbedded:U.isEmbedded}):j.push({object:U.object,predicate:U.predicate,subject:L,isEmbedded:U.isEmbedded})}}this.parsingContext.unidentifiedValuesBuffer.splice(w,1),this.parsingContext.literalStack.splice(w,1),this.parsingContext.jsonLiteralStack.splice(w,1)}const b=this.parsingContext.unidentifiedGraphsBuffer[w];if(b){for(const L of m){const P=w===1&&L.termType==="BlankNode"&&!this.parsingContext.topLevelProperties?this.util.getDefaultGraph():L;this.parsingContext.emittedStack[w]=!0;for(const A of b)this.parsingContext.emitQuad(w,this.util.dataFactory.quad(A.subject,A.predicate,A.object,P))}this.parsingContext.unidentifiedGraphsBuffer.splice(w,1)}const T=this.parsingContext.annotationsBuffer[w];if(T){T.length>0&&w===1&&this.parsingContext.emitError(new s.ErrorCoded("Annotations can not be made on top-level nodes",s.ERROR_CODES.INVALID_ANNOTATION));const L=this.parsingContext.getAnnotationsBufferSafe(w-1);for(const P of T)L.push(P);delete this.parsingContext.annotationsBuffer[w]}}async validateKey(w,C,m){for(const D of z.ENTRY_HANDLERS)if(await D.validate(this.parsingContext,this.util,w,C,m))return{valid:!0,property:m||D.isPropertyHandler()};return{valid:!1,property:!1}}attachJsonParserListeners(){this.jsonParser.onValue=w=>{const C=this.jsonParser.stack.length,m=new Array(C+1).fill(0).map((D,y)=>y===C?this.jsonParser.key:this.jsonParser.stack[y].key);if(!this.isParsingContextInner(C)){const D=()=>this.newOnValueJob(m,w,C,!0);if(!this.parsingContext.streamingProfile&&!this.parsingContext.contextTree.getContext(m.slice(0,-1)))if(m[C]==="@context"){let y=this.contextJobs[C];y||(y=this.contextJobs[C]=[]),y.push(D)}else this.contextAwaitingJobs.push({job:D,keys:m,depth:C});else this.lastOnValueJob=this.lastOnValueJob.then(D);!this.parsingContext.streamingProfile&&C===0&&(this.lastOnValueJob=this.lastOnValueJob.then(()=>this.executeBufferedJobs()))}},this.jsonParser.onError=w=>{this.emit("error",w)}}isParsingContextInner(w){for(let C=w;C>0;C--)if(this.jsonParser.stack[C-1].key==="@context")return!0;return!1}async executeBufferedJobs(){for(const C of this.contextJobs)if(C)for(const m of C)await m();this.parsingContext.unaliasedKeywordCacheStack.splice(0);const w=[];for(const C of this.contextAwaitingJobs)await this.util.unaliasKeyword(C.keys[C.depth],C.keys,C.depth,!0)==="@type"||typeof C.keys[C.depth]=="number"&&await this.util.unaliasKeyword(C.keys[C.depth-1],C.keys,C.depth-1,!0)==="@type"?this.typeJobs.push({job:C.job,keys:C.keys.slice(0,C.keys.length-1)}):w.push(C);for(const C of w){if(this.typeJobs.length>0){const m=[],D=[];for(let T=0;T<this.typeJobs.length;T++){const L=this.typeJobs[T];x.Util.isPrefixArray(L.keys,C.keys)&&(m.push(L),D.push(T))}const y=m.sort((T,L)=>T.keys.length-L.keys.length);for(const T of y)await T.job();const b=D.sort().reverse();for(const T of b)this.typeJobs.splice(T,1)}await C.job()}}};return I.DEFAULT_PROCESSING_MODE="1.1",I.ENTRY_HANDLERS=[new g.EntryHandlerArrayValue,new e.EntryHandlerKeywordContext,new n.EntryHandlerKeywordId,new a.EntryHandlerKeywordIncluded,new t.EntryHandlerKeywordGraph,new l.EntryHandlerKeywordNest,new E.EntryHandlerKeywordType,new p.EntryHandlerKeywordValue,new S.EntryHandlerKeywordAnnotation,new o.EntryHandlerContainer,new f.EntryHandlerKeywordUnknownFallback,new r.EntryHandlerPredicate,new u.EntryHandlerInvalidFallback],Q.JsonLdParser=I,Q}var _t;function yr(){return _t||(_t=1,function(d){var s=q&&q.__createBinding||(Object.create?function(g,o,u,r){r===void 0&&(r=u);var e=Object.getOwnPropertyDescriptor(o,u);(!e||("get"in e?!o.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return o[u]}}),Object.defineProperty(g,r,e)}:function(g,o,u,r){r===void 0&&(r=u),g[r]=o[u]}),c=q&&q.__exportStar||function(g,o){for(var u in g)u!=="default"&&!Object.prototype.hasOwnProperty.call(o,u)&&s(o,g,u)};Object.defineProperty(d,"__esModule",{value:!0}),c(vt(),d)}(q)),q}var Er=yr();const He="null:";function gr(d){return s=>s.termType!=="NamedNode"||!s.value.startsWith(He)?null:d.namedNode(s.value.slice(He.length))}function pr(d){const s=gr(d);return c=>{const g=s(c.subject),o=s(c.predicate),u=s(c.object),r=s(c.graph);return g||o||u||r?d.quad(g||c.subject,o||c.predicate,u||c.object,r||c.graph):c}}class wr{constructor(s,{baseIRI:c=He,context:g=null,documentLoader:o,factory:u=Bt}={}){const r=new Er.JsonLdParser({baseIRI:c,context:g,dataFactory:u,documentLoader:o,streamingProfile:!1});s.pipe(r);const e=pr(u),t=new Mt.Transform({objectMode:!0,transform:(n,a,l)=>{l(null,e(n))}});return r.on("context",n=>{Object.entries(n).forEach(([a,l])=>{t.emit("prefix",a,u.namedNode(l))})}),r.on("error",n=>t.destroy(n)),r.pipe(t),kt(t)}}class kr extends Ft{constructor(s){super(wr,s)}}export{kr as default};
